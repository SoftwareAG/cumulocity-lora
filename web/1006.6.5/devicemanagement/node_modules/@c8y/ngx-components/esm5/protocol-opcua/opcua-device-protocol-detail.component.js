import * as tslib_1 from "tslib";
import { Component, OnInit, ViewChildren, QueryList, Input, Output, EventEmitter, ViewChild, OnChanges, ChangeDetectorRef } from '@angular/core';
import { Router } from '@angular/router';
import { OpcuaService } from './opcuaService';
import { AlertService, gettext } from '@c8y/ngx-components';
import { find, assign, omit, findIndex, pick, get } from 'lodash';
import { OpcuaDeviceProtocolMapping } from './opcua-device-protocol-mapping.component';
var OpcuaDeviceProtocolDetailComponent = /** @class */ (function () {
    function OpcuaDeviceProtocolDetailComponent(changeDetectorRef, opcuaService, alertService, router) {
        var _this = this;
        this.changeDetectorRef = changeDetectorRef;
        this.opcuaService = opcuaService;
        this.alertService = alertService;
        this.router = router;
        this.initialModel = {
            id: '',
            fieldbusType: 'opcuaV2',
            description: '',
            unit: '',
            fieldbusVersion: 4,
            name: '',
            referencedServerId: '',
            referencedRootNodeId: '',
            subscriptionType: {
                type: 'None'
            },
            mappings: [],
            overriddenSubscriptions: [],
            applyConstraints: {
                browsePathMatchesRegex: '',
                matchesNodeIds: [],
                serverObjectHasFragment: '',
                matchesServerIds: []
            },
            enabled: ''
        };
        this.isLoaded = true;
        this.getParentAttr = function (key) { return get(_this.model, key); };
    }
    OpcuaDeviceProtocolDetailComponent.prototype.ngAfterContentChecked = function () {
        this.changeDetectorRef.detectChanges();
    };
    OpcuaDeviceProtocolDetailComponent.prototype.getMapping = function () {
        return this.model.mappings;
    };
    OpcuaDeviceProtocolDetailComponent.prototype.getEmptyMappingObject = function () {
        return {
            id: 'new',
            browsePath: []
        };
    };
    OpcuaDeviceProtocolDetailComponent.prototype.getOverriddenSubscriptionsByPath = function (browsePath) {
        return find(this.model.overriddenSubscriptions, { browsePath: browsePath });
    };
    OpcuaDeviceProtocolDetailComponent.prototype.getStructuredResource = function (resource) {
        var overriddenSubscriptions = this.getOverriddenSubscriptionsByPath(resource.browsePath);
        var result = assign({}, resource);
        if (overriddenSubscriptions) {
            result = assign({}, resource, { subscriptionType: overriddenSubscriptions.subscriptionType });
        }
        return result;
    };
    OpcuaDeviceProtocolDetailComponent.prototype.ngOnInit = function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var id, res, data, _a, data;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        id = this.opcuaService.getId();
                        if (!id) return [3 /*break*/, 7];
                        return [4 /*yield*/, this.opcuaService.getDeviceProtocol(id)];
                    case 1:
                        res = _b.sent();
                        if (!(res && res.status !== 200)) return [3 /*break*/, 5];
                        if (!res.json) return [3 /*break*/, 3];
                        return [4 /*yield*/, res.json()];
                    case 2:
                        _a = _b.sent();
                        return [3 /*break*/, 4];
                    case 3:
                        _a = undefined;
                        _b.label = 4;
                    case 4:
                        data = _a;
                        this.alertService.addServerFailure({ data: data, res: res });
                        this.isLoaded = false;
                        return [3 /*break*/, 7];
                    case 5: return [4 /*yield*/, res.json()];
                    case 6:
                        data = _b.sent();
                        if (data && data.applyConstraints === null) {
                            delete data.applyConstraints;
                        }
                        if (data && data.subscriptionType === null) {
                            delete data.subscriptionType;
                        }
                        this.model = assign(this.initialModel, data);
                        if (!this.model.mappings) {
                            this.model.mappings = [];
                        }
                        this.model = assign(this.initialModel, this.updateViableMapping(data));
                        this.isLoaded = false;
                        _b.label = 7;
                    case 7: return [2 /*return*/];
                }
            });
        });
    };
    OpcuaDeviceProtocolDetailComponent.prototype.updateViableMapping = function (model) {
        var mappings = model.mappings;
        var result = [];
        if (mappings) {
            result = mappings.map(function (item, i) {
                return assign(item, { id: i });
            });
        }
        return assign(model, { mappings: result });
    };
    OpcuaDeviceProtocolDetailComponent.prototype.trackByIndex = function (index) {
        return index;
    };
    OpcuaDeviceProtocolDetailComponent.prototype.addVariable = function () {
        this.model.mappings.push(this.getEmptyMappingObject());
    };
    OpcuaDeviceProtocolDetailComponent.prototype.updateVariable = function (mappingObject) {
        var mappings = this.model.mappings;
        var index = findIndex(mappings, { id: mappingObject.id });
        mappings.splice(index, 1);
        if (mappingObject.id === 'new') {
            mappingObject.id = mappings.length;
        }
        mappings.push(mappingObject);
    };
    OpcuaDeviceProtocolDetailComponent.prototype.removeVariable = function (mappingObject) {
        var mappings = this.model.mappings;
        var index = findIndex(mappings, { id: mappingObject.id });
        mappings.splice(index, 1);
    };
    OpcuaDeviceProtocolDetailComponent.prototype.actionHandler = function (actionObject) {
        switch (actionObject.action) {
            case 'save':
                this.updateVariable(actionObject.data);
                break;
            case 'delete':
                this.removeVariable(actionObject.data);
                break;
        }
    };
    OpcuaDeviceProtocolDetailComponent.prototype.extractOverridSubscriptionType = function (_mapping) {
        var overriddenSubscriptions = [];
        var variableMapping = [];
        _mapping.forEach(function (element) {
            if (element.id !== 'new') {
                if (element.subscriptionType) {
                    overriddenSubscriptions.push(assign({ browsePath: element.browsePath }, { subscriptionType: element.subscriptionType }));
                }
                variableMapping.push(omit(element, ['subscriptionType']));
            }
        });
        return [variableMapping, overriddenSubscriptions];
    };
    OpcuaDeviceProtocolDetailComponent.prototype.prepareRequestJson = function (_model) {
        var requestJson = {};
        var _a = tslib_1.__read(this.extractOverridSubscriptionType(_model.mappings), 2), mappings = _a[0], overriddenSubscriptions = _a[1];
        requestJson = assign(requestJson, pick(_model, Object.keys(this.initialModel)), {
            mappings: mappings,
            overriddenSubscriptions: overriddenSubscriptions
        });
        return requestJson;
    };
    OpcuaDeviceProtocolDetailComponent.prototype.save = function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var res, ex_1;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, this.opcuaService.updateDeviceProtocol(this.prepareRequestJson(this.model))];
                    case 1:
                        res = _a.sent();
                        if (res && res.status === 200) {
                            this.router.navigate(['deviceprotocols']);
                            this.alertService.success(gettext('Device protocol saved.'));
                        }
                        else {
                            this.alertService.addServerFailure({ res: res });
                        }
                        return [3 /*break*/, 3];
                    case 2:
                        ex_1 = _a.sent();
                        this.alertService.danger(gettext('Failed to save. Try again.'));
                        return [3 /*break*/, 3];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    OpcuaDeviceProtocolDetailComponent.prototype.canSave = function (deviceTypeForm) {
        if (this.instanceList) {
            var activeInstances = this.instanceList.filter(function (item) { return item.isActive(); });
            if (activeInstances.length > 0) {
                return true;
            }
        }
        return !deviceTypeForm.form.valid;
    };
    OpcuaDeviceProtocolDetailComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: OpcuaService },
        { type: AlertService },
        { type: Router }
    ]; };
    tslib_1.__decorate([
        ViewChildren(OpcuaDeviceProtocolMapping)
    ], OpcuaDeviceProtocolDetailComponent.prototype, "instanceList", void 0);
    OpcuaDeviceProtocolDetailComponent = tslib_1.__decorate([
        Component({
            selector: 'opcua-device-protocol-detail',
            template: "<c8y-title *ngIf=\"!isLoaded\">{{ model.name }}</c8y-title>\n<div>\n  <form #deviceTypeForm=\"ngForm\" name=\"detailForm\" *ngIf=\"!isLoaded\">\n    <opcua-device-protocol-description [model]=\"model\"></opcua-device-protocol-description>\n    <div class=\"card m-b-4\">\n      <div class=\"card-header separator\">\n        <h4 translate>Variables</h4>\n      </div>\n      <div class=\"list-group\" *ngIf=\"model.mappings.length > 0\" ngModelGroup=\"variable\">\n        <opcua-device-protocol-mapping\n          *ngFor=\"let resource of getMapping(); trackBy: trackByIndex; let i = index\"\n          [index]=\"i\"\n          [referencedServerId]=\"model.referencedServerId\"\n          [referencedRootNodeId]=\"model.referencedRootNodeId\"\n          [resource]=\"getStructuredResource(resource)\"\n          [getParentAttr]=\"getParentAttr\"\n          (onAction)=\"actionHandler($event)\"\n        >\n        </opcua-device-protocol-mapping>\n      </div>\n      <div class=\"card-block\">\n        <div class=\"c8y-empty-state text-left\" *ngIf=\"model.mappings.length === 0\">\n          <h1 c8yIcon=\"sliders\"></h1>\n          <p translate>No variables to display. Click below to add.</p>\n        </div>\n        <button\n          title=\"{{ 'Add variable' | translate }}\"\n          class=\"btn-add-block addVariableBtn\"\n          (click)=\"addVariable()\"\n        >\n          <i c8yIcon=\"plus-square\"></i> {{ 'Add variable' | translate }}\n        </button>\n      </div>\n    </div>\n    <div class=\"card m-b-4\">\n      <div class=\"card-header separator\">\n        <h4 translate>Data reporting</h4>\n      </div>\n      <div class=\"card-block\" ngModelGroup=\"subscription\">\n        <opcua-device-protocol-data-reporting\n          [groupName]=\"'subscription'\"\n          [model]=\"model\"\n        ></opcua-device-protocol-data-reporting>\n      </div>\n    </div>\n    <div class=\"card\">\n      <div class=\"card-header separator\">\n        <h4 translate>Auto apply constraints</h4>\n      </div>\n      <div class=\"card-block overflow-visible\" ngModelGroup=\"autoApply\">\n        <opcua-auto-apply [model]=\"model\"></opcua-auto-apply>\n      </div>\n    </div>\n\n    <span>\n      <div class=\"text-center page-footer m-t-16\">\n        <div class=\"btn-save-wrapper animated\">\n          <button\n            title=\"{{ 'Save' | translate }}\"\n            id=\"deviceTypeSave\"\n            class=\"btn btn-primary\"\n            (click)=\"save()\"\n            [disabled]=\"canSave(deviceTypeForm)\"\n            translate\n          >\n            Save\n          </button>\n        </div>\n      </div>\n    </span>\n  </form>\n</div>\n"
        })
    ], OpcuaDeviceProtocolDetailComponent);
    return OpcuaDeviceProtocolDetailComponent;
}());
export { OpcuaDeviceProtocolDetailComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtZGV2aWNlLXByb3RvY29sLWRldGFpbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYzh5L25neC1jb21wb25lbnRzL3Byb3RvY29sLW9wY3VhLyIsInNvdXJjZXMiOlsib3BjdWEtZGV2aWNlLXByb3RvY29sLWRldGFpbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBQ1osU0FBUyxFQUNULFNBQVMsRUFDVCxpQkFBaUIsRUFDbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRTVELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFTLEdBQUcsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUN6RSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQU12RjtJQStCRSw0Q0FDVSxpQkFBb0MsRUFDcEMsWUFBMEIsRUFDMUIsWUFBMEIsRUFDMUIsTUFBYztRQUp4QixpQkFLSTtRQUpNLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQWhDeEIsaUJBQVksR0FBb0I7WUFDOUIsRUFBRSxFQUFFLEVBQUU7WUFDTixZQUFZLEVBQUUsU0FBUztZQUN2QixXQUFXLEVBQUUsRUFBRTtZQUNmLElBQUksRUFBRSxFQUFFO1lBQ1IsZUFB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Q0FBQyxPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxDQUFDO3lCQUM5RDs2QkFBTTs0QkFDTCxJQUFJLENBQUMsWUFBWSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsR0FBRyxLQUFBLEVBQUUsQ0FBQyxDQUFDO3lCQUM3Qzs7Ozt3QkFFRCxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsNEJBQTRCLENBQUMsQ0FBQyxDQUFDOzs7Ozs7S0FFbkU7SUFFRCxvREFBTyxHQUFQLFVBQVEsY0FBYztRQUNwQixJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDckIsSUFBTSxlQUFlLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQWYsQ0FBZSxDQUFDLENBQUM7WUFFMUUsSUFBSSxlQUFlLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDOUIsT0FBTyxJQUFJLENBQUM7YUFDYjtTQUNGO1FBQ0QsT0FBTyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3BDLENBQUM7O2dCQW5LNEIsaUJBQWlCO2dCQUN0QixZQUFZO2dCQUNaLFlBQVk7Z0JBQ2xCLE1BQU07O0lBbENrQjtRQUF6QyxZQUFZLENBQUMsMEJBQTBCLENBQUM7NEVBQXFEO0lBRG5GLGtDQUFrQztRQUo5QyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsOEJBQThCO1lBQ3hDLHdvRkFBa0Q7U0FDbkQsQ0FBQztPQUNXLGtDQUFrQyxDQW9NOUM7SUFBRCx5Q0FBQztDQUFBLEFBcE1ELElBb01DO1NBcE1ZLGtDQUFrQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBWaWV3Q2hpbGRyZW4sXG4gIFF1ZXJ5TGlzdCxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBWaWV3Q2hpbGQsXG4gIE9uQ2hhbmdlcyxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgT3BjdWFTZXJ2aWNlIH0gZnJvbSAnLi9vcGN1YVNlcnZpY2UnO1xuaW1wb3J0IHsgTmdGb3JtIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQWxlcnRTZXJ2aWNlLCBnZXR0ZXh0IH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5pbXBvcnQgeyBPcGN1YURldmljZVR5cGUgfSBmcm9tICcuL29wY3VhLXByb3RvY29sLWRldmljZS10eXBlLmludGVyZmFjZSc7XG5pbXBvcnQgeyBmaW5kLCBhc3NpZ24sIG9taXQsIGZpbmRJbmRleCwgcGljaywgdW5zZXQsIGdldCB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBPcGN1YURldmljZVByb3RvY29sTWFwcGluZyB9IGZyb20gJy4vb3BjdWEtZGV2aWNlLXByb3RvY29sLW1hcHBpbmcuY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnb3BjdWEtZGV2aWNlLXByb3RvY29sLWRldGFpbCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9vcGN1YS1kZXZpY2UtcHJvdG9jb2wtZGV0YWlsLmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIE9wY3VhRGV2aWNlUHJvdG9jb2xEZXRhaWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBAVmlld0NoaWxkcmVuKE9wY3VhRGV2aWNlUHJvdG9jb2xNYXBwaW5nKSBpbnN0YW5jZUxpc3Q6IFF1ZXJ5TGlzdDxPcGN1YURldmljZVByb3RvY29sTWFwcGluZz47XG5cbiAgaW5pdGlhbE1vZGVsOiBPcGN1YURldmljZVR5cGUgPSB7XG4gICAgaWQ6ICcnLFxuICAgIGZpZWxkYnVzVHlwZTogJ29wY3VhVjInLFxuICAgIGRlc2NyaXB0aW9uOiAnJyxcbiAgICB1bml0OiAnJyxcbiAgICBmaWVsZGJ1c1ZlcnNpb246IDQsXG4gICAgbmFtZTogJycsXG4gICAgcmVmZXJlbmNlZFNlcnZlcklkOiAnJyxcbiAgICByZWZlcmVuY2VkUm9vdE5vZGVJZDogJycsXG4gICAgc3Vic2NyaXB0aW9uVHlwZToge1xuICAgICAgdHlwZTogJ05vbmUnXG4gICAgfSxcbiAgICBtYXBwaW5nczogW10sXG4gICAgb3ZlcnJpZGRlblN1YnNjcmlwdGlvbnM6IFtdLFxuICAgIGFwcGx5Q29uc3RyYWludHM6IHtcbiAgICAgIGJyb3dzZVBhdGhNYXRjaGVzUmVnZXg6ICcnLFxuICAgICAgbWF0Y2hlc05vZGVJZHM6IFtdLFxuICAgICAgc2VydmVyT2JqZWN0SGFzRnJhZ21lbnQ6ICcnLFxuICAgICAgbWF0Y2hlc1NlcnZlcklkczogW11cbiAgICB9LFxuICAgIGVuYWJsZWQ6ICcnXG4gIH07XG5cbiAgbW9kZWw6IGFueTtcbiAgc2VydmVyOiBhbnk7XG4gIHNlbGVjdGVkTm9kZTogYW55O1xuICBpc0xvYWRlZCA9IHRydWU7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBvcGN1YVNlcnZpY2U6IE9wY3VhU2VydmljZSxcbiAgICBwcml2YXRlIGFsZXJ0U2VydmljZTogQWxlcnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXJcbiAgKSB7fVxuXG4gIG5nQWZ0ZXJDb250ZW50Q2hlY2tlZCgpIHtcbiAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIGdldFBhcmVudEF0dHIgPSBrZXkgPT4gZ2V0KHRoaXMubW9kZWwsIGtleSk7XG5cbiAgZ2V0TWFwcGluZygpIHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbC5tYXBwaW5ncztcbiAgfVxuXG4gIGdldEVtcHR5TWFwcGluZ09iamVjdCgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6ICduZXcnLFxuICAgICAgYnJvd3NlUGF0aDogW11cbiAgICB9O1xuICB9XG5cbiAgZ2V0T3ZlcnJpZGRlblN1YnNjcmlwdGlvbnNCeVBhdGgoYnJvd3NlUGF0aCkge1xuICAgIHJldHVybiBmaW5kKHRoaXMubW9kZWwub3ZlcnJpZGRlblN1YnNjcmlwdGlvbnMsIHsgYnJvd3NlUGF0aCB9KTtcbiAgfVxuXG4gIGdldFN0cnVjdHVyZWRSZXNvdXJjZShyZXNvdXJjZSkge1xuICAgIGNvbnN0IG92ZXJyaWRkZW5TdWJzY3JpcHRpb25zID0gdGhpcy5nZXRPdmVycmlkZGVuU3Vic2NyaXB0aW9uc0J5UGF0aChyZXNvdXJjZS5icm93c2VQYXRoKTtcbiAgICBsZXQgcmVzdWx0ID0gYXNzaWduKHt9LCByZXNvdXJjZSk7XG4gICAgaWYgKG92ZXJyaWRkZW5TdWJzY3JpcHRpb25zKSB7XG4gICAgICByZXN1bHQgPSBhc3NpZ24oe30sIHJlc291cmNlLCB7IHN1YnNjcmlwdGlvblR5cGU6IG92ZXJyaWRkZW5TdWJzY3JpcHRpb25zLnN1YnNjcmlwdGlvblR5cGUgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBhc3luYyBuZ09uSW5pdCgpIHtcbiAgICBjb25zdCBpZCA9IHRoaXMub3BjdWFTZXJ2aWNlLmdldElkKCk7XG4gICAgaWYgKGlkKSB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLm9wY3VhU2VydmljZS5nZXREZXZpY2VQcm90b2NvbChpZCk7XG4gICAgICBpZiAocmVzICYmIHJlcy5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICBjb25zdCBkYXRhID0gcmVzLmpzb24gPyBhd2FpdCByZXMuanNvbigpIDogdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFsZXJ0U2VydmljZS5hZGRTZXJ2ZXJGYWlsdXJlKHsgZGF0YSwgcmVzIH0pO1xuICAgICAgICB0aGlzLmlzTG9hZGVkID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5hcHBseUNvbnN0cmFpbnRzID09PSBudWxsKSB7XG4gICAgICAgICAgZGVsZXRlIGRhdGEuYXBwbHlDb25zdHJhaW50cztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLnN1YnNjcmlwdGlvblR5cGUgPT09IG51bGwpIHtcbiAgICAgICAgICBkZWxldGUgZGF0YS5zdWJzY3JpcHRpb25UeXBlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubW9kZWwgPSBhc3NpZ24odGhpcy5pbml0aWFsTW9kZWwsIGRhdGEpO1xuICAgICAgICBpZiAoIXRoaXMubW9kZWwubWFwcGluZ3MpIHtcbiAgICAgICAgICB0aGlzLm1vZGVsLm1hcHBpbmdzID0gW107XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tb2RlbCA9IGFzc2lnbih0aGlzLmluaXRpYWxNb2RlbCwgdGhpcy51cGRhdGVWaWFibGVNYXBwaW5nKGRhdGEpKTtcbiAgICAgICAgdGhpcy5pc0xvYWRlZCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZVZpYWJsZU1hcHBpbmcobW9kZWwpIHtcbiAgICBjb25zdCB7IG1hcHBpbmdzIH0gPSBtb2RlbDtcbiAgICBsZXQgcmVzdWx0ID0gW107XG4gICAgaWYgKG1hcHBpbmdzKSB7XG4gICAgICByZXN1bHQgPSBtYXBwaW5ncy5tYXAoKGl0ZW0sIGkpID0+IHtcbiAgICAgICAgcmV0dXJuIGFzc2lnbihpdGVtLCB7IGlkOiBpIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBhc3NpZ24obW9kZWwsIHsgbWFwcGluZ3M6IHJlc3VsdCB9KTtcbiAgfVxuXG4gIHRyYWNrQnlJbmRleChpbmRleDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gaW5kZXg7XG4gIH1cblxuICBhZGRWYXJpYWJsZSgpIHtcbiAgICB0aGlzLm1vZGVsLm1hcHBpbmdzLnB1c2godGhpcy5nZXRFbXB0eU1hcHBpbmdPYmplY3QoKSk7XG4gIH1cblxuICB1cGRhdGVWYXJpYWJsZShtYXBwaW5nT2JqZWN0KSB7XG4gICAgY29uc3QgeyBtYXBwaW5ncyB9ID0gdGhpcy5tb2RlbDtcbiAgICBjb25zdCBpbmRleCA9IGZpbmRJbmRleChtYXBwaW5ncywgeyBpZDogbWFwcGluZ09iamVjdC5pZCB9KTtcbiAgICBtYXBwaW5ncy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIGlmIChtYXBwaW5nT2JqZWN0LmlkID09PSAnbmV3Jykge1xuICAgICAgbWFwcGluZ09iamVjdC5pZCA9IG1hcHBpbmdzLmxlbmd0aDtcbiAgICB9XG4gICAgbWFwcGluZ3MucHVzaChtYXBwaW5nT2JqZWN0KTtcbiAgfVxuXG4gIHJlbW92ZVZhcmlhYmxlKG1hcHBpbmdPYmplY3QpIHtcbiAgICBjb25zdCB7IG1hcHBpbmdzIH0gPSB0aGlzLm1vZGVsO1xuICAgIGNvbnN0IGluZGV4ID0gZmluZEluZGV4KG1hcHBpbmdzLCB7IGlkOiBtYXBwaW5nT2JqZWN0LmlkIH0pO1xuICAgIG1hcHBpbmdzLnNwbGljZShpbmRleCwgMSk7XG4gIH1cblxuICBhY3Rpb25IYW5kbGVyKGFjdGlvbk9iamVjdCkge1xuICAgIHN3aXRjaCAoYWN0aW9uT2JqZWN0LmFjdGlvbikge1xuICAgICAgY2FzZSAnc2F2ZSc6XG4gICAgICAgIHRoaXMudXBkYXRlVmFyaWFibGUoYWN0aW9uT2JqZWN0LmRhdGEpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2RlbGV0ZSc6XG4gICAgICAgIHRoaXMucmVtb3ZlVmFyaWFibGUoYWN0aW9uT2JqZWN0LmRhdGEpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBleHRyYWN0T3ZlcnJpZFN1YnNjcmlwdGlvblR5cGUoX21hcHBpbmcpIHtcbiAgICBjb25zdCBvdmVycmlkZGVuU3Vic2NyaXB0aW9ucyA9IFtdO1xuICAgIGNvbnN0IHZhcmlhYmxlTWFwcGluZyA9IFtdO1xuICAgIF9tYXBwaW5nLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICBpZiAoZWxlbWVudC5pZCAhPT0gJ25ldycpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQuc3Vic2NyaXB0aW9uVHlwZSkge1xuICAgICAgICAgIG92ZXJyaWRkZW5TdWJzY3JpcHRpb25zLnB1c2goXG4gICAgICAgICAgICBhc3NpZ24oXG4gICAgICAgICAgICAgIHsgYnJvd3NlUGF0aDogZWxlbWVudC5icm93c2VQYXRoIH0sXG4gICAgICAgICAgICAgIHsgc3Vic2NyaXB0aW9uVHlwZTogZWxlbWVudC5zdWJzY3JpcHRpb25UeXBlIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHZhcmlhYmxlTWFwcGluZy5wdXNoKG9taXQoZWxlbWVudCwgWydzdWJzY3JpcHRpb25UeXBlJ10pKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gW3ZhcmlhYmxlTWFwcGluZywgb3ZlcnJpZGRlblN1YnNjcmlwdGlvbnNdO1xuICB9XG5cbiAgcHJlcGFyZVJlcXVlc3RKc29uKF9tb2RlbCkge1xuICAgIGxldCByZXF1ZXN0SnNvbiA9IHt9O1xuICAgIGNvbnN0IFttYXBwaW5ncywgb3ZlcnJpZGRlblN1YnNjcmlwdGlvbnNdID0gdGhpcy5leHRyYWN0T3ZlcnJpZFN1YnNjcmlwdGlvblR5cGUoXG4gICAgICBfbW9kZWwubWFwcGluZ3NcbiAgICApO1xuICAgIHJlcXVlc3RKc29uID0gYXNzaWduKHJlcXVlc3RKc29uLCBwaWNrKF9tb2RlbCwgT2JqZWN0LmtleXModGhpcy5pbml0aWFsTW9kZWwpKSwge1xuICAgICAgbWFwcGluZ3MsXG4gICAgICBvdmVycmlkZGVuU3Vic2NyaXB0aW9uc1xuICAgIH0pO1xuICAgIHJldHVybiByZXF1ZXN0SnNvbjtcbiAgfVxuXG4gIGFzeW5jIHNhdmUoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMub3BjdWFTZXJ2aWNlLnVwZGF0ZURldmljZVByb3RvY29sKHRoaXMucHJlcGFyZVJlcXVlc3RKc29uKHRoaXMubW9kZWwpKTtcblxuICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWydkZXZpY2Vwcm90b2NvbHMnXSk7XG4gICAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLnN1Y2Nlc3MoZ2V0dGV4dCgnRGV2aWNlIHByb3RvY29sIHNhdmVkLicpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLmFkZFNlcnZlckZhaWx1cmUoeyByZXMgfSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLmRhbmdlcihnZXR0ZXh0KCdGYWlsZWQgdG8gc2F2ZS4gVHJ5IGFnYWluLicpKTtcbiAgICB9XG4gIH1cblxuICBjYW5TYXZlKGRldmljZVR5cGVGb3JtKSB7XG4gICAgaWYgKHRoaXMuaW5zdGFuY2VMaXN0KSB7XG4gICAgICBjb25zdCBhY3RpdmVJbnN0YW5jZXMgPSB0aGlzLmluc3RhbmNlTGlzdC5maWx0ZXIoaXRlbSA9PiBpdGVtLmlzQWN0aXZlKCkpO1xuXG4gICAgICBpZiAoYWN0aXZlSW5zdGFuY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiAhZGV2aWNlVHlwZUZvcm0uZm9ybS52YWxpZDtcbiAgfVxufVxuIl19