"use strict";!function(){function e(e,t,n,u,i,r,a,s,o,c){var p="service/device-simulator/simulators",m={RUNNING:"RUNNING",PAUSED:"PAUSED"},l=[{fragment:"c8y_Configuration",name:u("Configuration")},{fragment:"c8y_Software",name:u("Software update")},{fragment:"c8y_Restart",name:u("Device restart")},{fragment:"c8y_Firmware",name:u("Firmware update")}],d=[{name:u("Empty simulator"),data:{instances:1,state:m.PAUSED,name:u("Empty simulator"),commandQueue:[{type:"sleep",seconds:5}],supportedOperations:{}}},{name:u("Temperature measurements"),data:{instances:1,state:m.PAUSED,name:u("Temperature"),commandQueue:_.reduce([2.0791169082,9.1354545764,8.0901699437,6.6913060636,5,3.0901699437,1.0452846327,-1.0452846327,-3.0901699437,-5,-6.6913060636,-8.0901699437,-9.1354545764,-9.7814760073,-10,-9.7814760073,-9.1354545764,-8.0901699437,-6.6913060636,-5,-3.0901699437,-1.0452846327,1.0452846327,3.0901699437,5,6.6913060636,8.0901699437,9.1354545764,9.7814760073,10],function(e,t){return e.push({type:"builtin",messageId:200,values:["c8y_Temperature","T",t,"ÂºC"]}),e.push({type:"sleep",seconds:5}),e},[]),supportedOperations:{}}},{name:u("Position update event"),data:{instances:1,state:m.PAUSED,name:u("Position"),commandQueue:_.reduce([[6.758050918579102,51.225324115117],[6.75933837890625,51.22446407082351],[6.760711669921875,51.22338899285697],[6.762084960937499,51.222152622151995],[6.763544082641601,51.2212387615908],[6.765260696411133,51.21994857461735],[6.766977310180663,51.21828202959081],[6.769466400146484,51.21731433059918],[6.771183013916016,51.21849707104884],[6.772127151489258,51.219034670299344],[6.773672103881836,51.219088429879115],[6.778392791748047,51.2189809106568],[6.782083511352538,51.2189809106568],[6.782169342041016,51.22156130268409],[6.782941818237305,51.224356564156835],[6.783199310302734,51.22559287566293],[6.781654357910156,51.22709790571764],[6.780967712402344,51.23096775701038],[6.778907775878906,51.23403115849572],[6.777019500732422,51.23639574998666],[6.77478790283203,51.23961999708345],[6.774101257324219,51.24117830217582],[6.7730712890625,51.24300521333463],[6.771526336669922,51.24391864170407],[6.769380569458007,51.24542307241623],[6.767406463623046,51.247303541606165],[6.765689849853516,51.249130209480654],[6.762685775756836,51.24896903582209],[6.760110855102538,51.247464721101935],[6.7559051513671875,51.245154427683886],[6.753416061401367,51.24364998818434],[6.7517852783203125,51.242790286376156],[6.750326156616211,51.24198430133743],[6.74835205078125,51.24133950313797],[6.746463775634765,51.24080216440054],[6.741571426391602,51.24085589855674],[6.738824844360352,51.24085589855674],[6.73762321472168,51.24021108453954],[6.736078262329102,51.23897516574192],[6.734533309936523,51.23687940145701],[6.733760833740234,51.2353209507378],[6.7339324951171875,51.23467605913632],[6.733589172363281,51.23397741636766],[6.73384666442871,51.232741330096836],[6.735048294067383,51.231720190305005],[6.738395690917969,51.230645281832004],[6.7406272888183585,51.22989283096072],[6.742601394653319,51.22887162795567],[6.745090484619141,51.22811914808259],[6.749553680419922,51.22704415549173],[6.753501892089844,51.22645289886354],[6.756248474121093,51.22602288927206]],function(e,t){return e.push({type:"builtin",messageId:402,values:[t[1],t[0],0,10]}),e.push({type:"sleep",seconds:5}),e},[]),supportedOperations:{}}}];return{removeAfterConfirmation:function(e){var t={title:u("Delete simulator"),body:i.getString('You are about to delete simulator "{{name}}". Do you want to proceed?',e),size:"sm",labels:{ok:u("Delete")},status:"danger"},n=s(t),r=_.partial(y,e),a=_.partial(_.unary(o.success),u("Simulator deleted."));return n.then(r).then(a)},PRESETS:d,STATES:m,operations:function(){return e.when(l)},list:function(){var e=r.url(p);return n.get(e,{silentError:!0}).then(r.getResData)},detail:function(e){var t=f(e);return n.get(t).then(r.getResData)},remove:y,save:v,create:S,update:g,run:function(e){return g({id:e.id,state:m.RUNNING})},pause:function(e){return g({id:e.id,state:m.PAUSED})},clone:function(e){var t=_.cloneDeep(e);return delete t.id,t.state=m.PAUSED,S(t)},listAllPublishMessages:function(){return c.listAllPublishMessages().then(h).then(O)},findMessageForInstruction:A,Types:c.Types,addPreset:function(e){if(!e)return;_.isArray(e)?_.forEach(e,function(e){d.push(e)}):d.push(e)},toggleOperation:function(e,t){var n;n=C(e,t)?E(e,t):D(e,t);return n},addOperation:D,removeOperation:E,supportsOperation:C,addCustomOperation:function(e,t){return e.c8y_CustomOperations=_.concat(e.c8y_CustomOperations||[],[t]),v(_.pick(e,["id","c8y_CustomOperations"]))},removeCustomOperation:function(e,t){return e.c8y_CustomOperations=_.without(e.c8y_CustomOperations||[],t),v(_.pick(e,["id","c8y_CustomOperations"]))},instructionTitle:function(e,t){var n;if("sleep"===e.type)n=u("Sleep");else if("message"===e.type||"builtin"===e.type)if(e.messageId){var r=A(e,t);n=r&&r.name?r.name:u("Message")}else n=u("New message");return n},isAvailable:function(){var e=r.url(p);return n.head(e,{silentError:!0}).then(_.constant(!0),function(e){return e.status<500})}};function f(e){return r.url("".concat(p,"/").concat(r.getId(e)))}function y(e){var t=f(e);return n.delete(t)}function g(e){var t=f(e);return n.put(t,e).then(r.getResData)}function S(e){var t=r.url(p);return n.post(t,e).then(r.getResData)}function v(t){try{return g(t)}catch(e){return S(t)}}function h(e){return _.reject(e,{hideInSimulators:!0})}function O(e){var t=c.Types,n=[t.ARRAY.name,t.OBJECTARRAY.name];return _.reject(e,function(e){return _.some(e.values||[],function(e){return _.includes(n,e.type)})})}function A(t,e){return t.messageId?_.find(e,function(e){return String(e.msgId)===String(t.messageId)&&("builtin"===t.type||String(e._template.__externalId)===String(t.templateId))}):null}function D(e,t){var n=_.isString(t)?t:t.fragment;return e.c8y_SupportedOperations=_.union(e.c8y_SupportedOperations||[],[n]),v(_.pick(e,["id","c8y_SupportedOperations"]))}function E(e,t){var n=_.isString(t)?t:t.fragment;return e.c8y_SupportedOperations=_.without(e.c8y_SupportedOperations||[],n),v(_.pick(e,["id","c8y_SupportedOperations"]))}function C(e,t){var n=(e||{}).c8y_SupportedOperations||[],r=_.isString(t)?t:t.fragment;return-1<n.indexOf(r)}}e.$inject=["$q","$location","$http","gettext","gettextCatalog","c8yBase","c8yTitle","c8yModal","c8yAlert","c8ySmartRestTemplates"],angular.module("c8y.simulators").factory("c8ySimulators",e)}();