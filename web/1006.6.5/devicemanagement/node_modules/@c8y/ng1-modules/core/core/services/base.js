"use strict";function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(t){_defineProperty(e,t,n[t])})}return e}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(){e.$inject=["$window","$q","$injector","$location","$interpolate","c8yConfig","info","c8yUtil","gettext","gettextCatalog"],window.c8y=window.c8y||{};var t=window.c8y;function k(t){return((window.C8Y_APP||{}).core_path||"/apps/core/")+t}function j(t){return((window.C8Y_APP||{}).data_path||(window.C8Y_PAAS?"/apps/core/c8ydata/":"/apps/c8ydata/"))+t}function z(t){var e=!0;try{_.forEach(t,function(t){angular.module(t)})}catch(t){e=!1}return e}function e(t,a,e,n,i,c,s,r,o,u){var f="application/vnd.com.nsn.cumulocity.",l=s.pageSize||100,g="YYYY-MM-DDTHH:mm:ssZ";function d(t){return"".concat(f+t,"+json")}function m(i){var o=["refresh","next"];return function n(t){var e=i(t),r=t.paging,a=t.statistics;return r&&(_.forEach(o,function(t){if(r[t]){var e=r[t];r[t]=function(){return e().then(n)}}}),e.paging=r,e.statistics=a),e}}function p(t,e){var n={};return e&&e.split("?")[1].split("&").forEach(function(t){var e=t.split("=");n[e[0]]=decodeURIComponent(e[1])}),n[t]}function v(t,e){var n=t.statistics,r=t[1===e?"next":"prev"],a=p("currentPage",r);return{currentPage:parseInt(a,10),pageSize:n.pageSize,startkey:p("startkey",r),startkey_docid:p("startkey_docid",r)}}function P(t,e,n,r){var a=t.statistics,i=!_.isUndefined(t.prev),o=!_.isUndefined(t.next),c={};return i&&(c.prev=function(){return e(_objectSpread({},n,v(t,-1)))}),o&&(c.next=function(){return e(_objectSpread({},n,v(t,1)))},_.isUndefined(a.totalPages)||(c.more=(a.totalPages-a.currentPage)*a.pageSize)),c.refresh=function(){return e(_.assign(_.cloneDeep(n),function(t){var e=t.statistics||{},n={currentPage:1,pageSize:e.pageSize*e.currentPage,startkey:null,startkey_docid:null};return _.isUndefined(t.totalPages)||(n.pageSize=e.pageSize),n}(t),{reusePaging:c}))},c.changePage=function(t){return e(_objectSpread({},n,{currentPage:t,pageSize:a.pageSize}))},c.statistics=a,c.blind=r,c}function h(t){var e=function(t){return _.flattenDeep(t)}(t),n=S(t),r=function(e){var t={statistics:S(e),blind:_.some(e,"paging.blind"),more:_.some(e,"paging.more")};t.more&&(t.next=function(){var t=_.map(e,function(t){return _.result(t,"paging.next",[])});return a.all(t).then(h)});return t}(t);return e.paging=r,e.statistics=n,e}function S(t){var e=_.map(t,function(t){return _.get(t,"statistics.currentPage",1)}),n=_.map(t,function(t){return _.get(t,"statistics.pageSize",t.length)}),r=_.map(t,function(t){return _.get(t,"statistics.totalPages",1)});return{currentPage:_.max(e),pageSize:_.sum(n),totalPages:_.max(r)}}function y(t,e){return _.omit(t,e)}function b(t){var e;if(_.isObjectLike(t)&&(e=t.id),(_.isNumber(t)||_.isString(t)&&t.match(/^\d+$/))&&(e=String(t)),_.isUndefined(e))throw new Error("id cannot be found");return e}function w(t){return s[t]}function F(n){var t=(s.appConfig||{}).manifest,e=window.C8Y_APP&&window.C8Y_APP.C8Y_INSTANCE_OPTIONS,r=window.C8Y_INSTANCE_OPTIONS,a=_.merge({},t,e,r),i=_.defaultsDeep(a,c.defaultAppOptions),o=i[n];return o||(o=_.find(i,function(t,e){return _.camelCase(n)===_.camelCase(e)})),i[n]}var O={url:function(t){return(s.baseUrl||"/")+t},absoluteUrl:function(t){return"".concat(n.protocol(),"://").concat(n.host(),":").concat(n.port())+"/".concat(_.isString(t)?t:"").replace(/\/+/g,"/")},getStaticLink:function(t,e){var n=F("staticLinks"),r=_.get(n,t,"");return r?a.resolve(i(r)(e)):a.reject("Static link was not found")},getStaticLinkTemplate:function(t){var e=F("staticLinks"),n=_.get(e,t,"");return n?a.resolve(n):a.reject("Static link template was not found")},deleteProperties:function(t,e){return y(t,e)},mimeType:d,contentHeaders:function(t,e){return{"Content-Type":d(t),Accept:e?d(_.isString(e)?e:t):void 0}},pageSizeFilter:function(t){return _.assign({withTotalPages:!0,pageSize:l},t)},pageSizeNoTotalFilter:function(t){return _.assign({pageSize:l},t)},timeOrderFilter:function(t){return _.assign({dateFrom:"1970-01-01",dateTo:moment().add(1,"day").format(g)},t)},lastWeekFilter:function(t){return _.assign({dateFrom:moment().subtract(1,"week").format(g),dateTo:moment().add(1,"day").format(g)},t)},todayFilter:function(t){return _.assign({dateFrom:moment().subtract(1,"day").format(g),dateTo:moment().add(1,"day").format(g)},t)},fromThisMonthStartFilter:function(t){return _.assign({dateFrom:moment().startOf("month").format(g)},t)},monthFilter:function(t,e){var n=moment().subtract(e||0,"months");return _.assign({dateFrom:n.startOf("month").format(g),dateTo:n.endOf("month").format(g)},t)},createListFilter:function(e){return m(function(t){return t.filter(e)})},createListMapper:function(e){return m(function(t){return t.map(e)})},cleanListCallback:function(r,a,i){var o=(i||{}).reusePaging;return delete i.reusePaging,function(t){var e=t.data||{},n=e[r]||[];return n.statistics=e.statistics,i.withTotalPages||n.length!==parseInt(i.pageSize,10)||(n.statistics.totalPages=1/0,e.statistics.totalPages=n.statistics.totalPages),n.paging=o||P(e,a,i,!i.withTotalPages),n}},combineLists:h,removeFromList:function(t,e){var n=t.indexOf(e);0<=n&&t.splice(n,1)},cleanFields:y,dateFormat:"YYYY-MM-DD",dateFullFormat:g,dateFullFormatWithMs:"YYYY-MM-DDTHH:mm:ss.SSSZ",invalid:function(t,e,n){var r=t&&t[e],a=r&&r[n],i=a&&a.$pristine,o=a&&a.$invalid;return!1===i&&!0===o},invalidFormOrField:function(t){return t.$dirty&&t.$invalid},validationHints:function(n,r){var a=[];return n&&n.$error&&_.forEach(n.$error,function(t,e){t&&!_.isUndefined(r[e])&&(_.isObjectLike(r[e])&&r[e][n.$name]?a.push(r[e][n.$name]):a.push(r[e]))}),_.map(a,function(t){return u.getString(t)}).join(" ")},getCount:function(t,e){return e.pageSize=1,e.withTotalPages=!0,t(e).then(function(t){return t.statistics.totalPages})},humanizeFragment:function(t){return String(t||"").replace(/c8y_/,"").replace(/([A-Z])/g," $1").replace(/^\s*/,"").replace(/\s*$/,"")},getResData:function(t){return _.get(t,"data",t)},getResErrorMessage:function(t){return _.head(_.compact(_.at(t,["data.message","data.error"])))||o("An error occurred.")},createEnum:function(t){var n={},r=0;return n.values=_.constant(_.map(t,function(t){var e={};return _.isObjectLike(t)?_.defaults(e,t,{name:t.name,value:t.name,label:t.name}):_.defaults(e,{name:t,value:t,label:t}),_.assign(e,{ordinal:r}),r+=1,n[e.name]=e})),n},createLocalId:function(t,e){var n=e||"id";if(!_.isObjectLike(t))throw new Error("mo is not an object");return _.isUndefined(t[n])&&(t[n]=String(Math.random()).substr(2)),t},hasId:function(t){var e=!0;try{b(t)}catch(t){e=!1}return e},getId:b,checkIfModulesExist:z,coreFilePath:k,dataFilePath:j,appOption:F,getPluginService:function(t){return e.has(t)?e.get(t):void 0},getFlag:w,getRuntimeOption:w,getParamFromUrl:p,PAGESIZE:l,MAX_PAGESIZE:2e3};return r.enhanceWithLatestFactoryUtil(O,a)}_.assign(t,{coreFilePath:k,dataFilePath:j,checkIfModulesExist:z}),angular.module("c8y.core").factory("c8yBase",e)}();