<div data-ng-controller="firmwareListCtrl as vm">
  <c8y-ui-action-bar-set>
    <li action-bar-position="left" class="navbar-form" ng-show="vm.firmwares.length > 0">
      <div class="input-group input-group-search">
        <input
          title="{{ 'Filter' | translate }}"
          type="search"
          class="form-control"
          placeholder="{{ 'Filter' | translate }}&hellip;"
          ng-model="vm.searchString"
        />
        <span class="input-group-addon">
          <i c8y-icon="search" ng-show="vm.searchString.length === 0 || !vm.searchString "></i>
          <i
            c8y-icon="times"
            class="text-muted"
            ng-show="vm.searchString.length > 0"
            ng-click="vm.searchString = ''"
          ></i>
        </span>
      </div>
    </li>

    <div
      class="dropdown"
      uib-dropdown
      auto-close="outsideClick"
      on-toggle="toggled(open, newFirmware)"
      is-open="vm.dropdownOpen"
    >
      <button
        title="{{ 'Add firmware' | translate }}"
        class="dropdown-toggle c8y-dropdown"
        uib-dropdown-toggle
        aria-haspopup="true"
        aria-expanded="false"
      >
        <span><i c8y-icon="plus-circle"></i> <translate>Add firmware</translate></span>
      </button>
      <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>
        <li class="dropdown-form">
          <form role="form" name="newFirmware" novalidate>
            <div class="form-group">
              <label translate>Name</label>
              <input
                type="text"
                class="form-control"
                ng-model="vm.newFw.name"
                placeholder="{{ 'e.g. My firmware' | translate }}"
                required
              />
            </div>
            <div class="form-group">
              <label translate>Version</label>
              <input
                type="text"
                class="form-control"
                ng-model="vm.newFw.version"
                placeholder="{{ 'e.g.' | translate }} 1.0.0"
                maxlength="100"
              />
            </div>
            <div class="form-group">
              <label translate>File</label>
              <c8y-binary-input
                initial-url="vm.newFw.url"
                set-global="true"
                output-file="vm.newFw.selectedFile"
                allow-free-url-input="true"
                file-required="true"
              ></c8y-binary-input>
            </div>
            <button
              title="{{ 'Save' | translate }}"
              class="btn btn-primary btn-block"
              ng-click="save(vm.newFw)"
              ng-disabled="newFirmware.$invalid"
              translate
            >
              Save
            </button>
          </form>
        </li>
      </ul>
    </div>

    <c8y-refresh-btn></c8y-refresh-btn>
  </c8y-ui-action-bar-set>

  <div class="c8y-empty-state text-center" ng-show="firmwares.length === 0">
    <h1><i c8y-icon="download"></i></h1>
    <h3 translate>No firmwares to display.</h3>
    <p translate>Add a firmware using the button on the toolbar.</p>
  </div>

  <div class="card-group interact-grid">
    <div
      class="col-xs-12 col-sm-6 col-md-4 col-lg-3"
      ng-repeat="fw in firmwares | filter:vm.searchString | orderBy:['name','version']"
    >
      <div class="card-flip-container" ng-class="{'flipping': isFlipped}">
        <div class="card-flip" ng-class="{'flipped': isFlipped}">
          <div class="card card-front">
            <div class="card-actions">
              <span class="dropdown settings" is-open="false" uib-dropdown>
                <button
                  title="{{ 'Actions' | translate }}"
                  type="button"
                  class="dropdown-toggle c8y-dropdown"
                  uib-dropdown-toggle
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  <i c8y-icon="ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>
                  <li>
                    <button
                      title="{{ 'Delete firmware' | translate }}"
                      type="button"
                      ng-click="onClickDelete(fw)"
                    >
                      <i c8y-icon="trash"></i> {{ 'Delete firmware' | translate }}
                    </button>
                  </li>
                </ul>
              </span>
            </div>
            <div class="card-block text-center flex-col flex-center" style="min-height: 260px;">
              <div class="dot" style="margin: 0 0 10px 0;"><i c8y-icon="download"></i></div>
              <h4 class="text-truncate bottom-m-sm" style="max-width: 100%;" title="{{ fw.name }}">
                {{ fw.name }}
              </h4>
              <small translate class="text-muted">Version</small>
              <p style="word-break: break-word;">{{ fw.version }}</p>
            </div>

            <div class="card-actions-group" style="position:static;">
              <button
                title="{{ 'Details' | translate }}"
                class="btn-flip"
                ng-click="isFlipped = !isFlipped; toggle(fw)"
              >
                <i c8y-icon="reply"></i> {{ 'Details' | translate }}
              </button>
            </div>
          </div>
          <!-- /.card-front -->

          <div class="card card-back bg-gray-lighter" aria-expanded="false" aria-hidden="true">
            <div class="card-inner-scroll" style="height: calc(100% - 40px);">
              <form name="firmwareForm" role="form" ng-if="isFlipped" class="card-block">
                <div class="form-group form-group-sm">
                  <label translate class="control-label small">Name</label>
                  <input
                    type="text"
                    class="form-control"
                    ng-model="fw.edited.name"
                    placeholder="{{ 'e.g. My firmware' | translate }}"
                    required
                  />
                </div>
                <div class="form-group form-group-sm">
                  <label translate class="control-label small">Version</label>
                  <input
                    type="text"
                    class="form-control"
                    ng-model="fw.edited.version"
                    placeholder="{{ 'e.g.' | translate }} 1.0.0"
                    maxlength="100"
                  />
                </div>
                <div class="form-group form-group-sm">
                  <label class="control-label small" translate>File</label>
                  <c8y-binary-input
                    initial-url="fw.url"
                    set-global="true"
                    output-file="fw.selectedFile"
                    allow-free-url-input="true"
                    file-required="true"
                    c8y-check-dirty="fw.selectedFile.name"
                  ></c8y-binary-input>
                </div>
                <button
                  title="{{ 'Save' | translate }}"
                  class="btn btn-primary btn-block btn-sm"
                  ng-click="save(fw)"
                  ng-disabled="firmwareForm.$invalid || firmwareForm.$pristine"
                  translate
                >
                  Save
                </button>
              </form>
            </div>

            <div class="card-actions-group">
              <button
                title="{{ 'Back' | translate }}"
                type="button"
                class="btn-flip"
                ng-click="isFlipped = !isFlipped; toggle(fw)"
              >
                <i c8y-icon="reply"></i> {{ 'Back' | translate }}
              </button>
            </div>
          </div>
          <!-- /.card-back -->
        </div>
      </div>
    </div>
    <!-- /.card-flip-container -->
    <c8y-load-more></c8y-load-more>
  </div>
</div>
