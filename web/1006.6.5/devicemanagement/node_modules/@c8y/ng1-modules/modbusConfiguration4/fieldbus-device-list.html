<div ng-if="vm.shouldShowSection()" class="card">
  <div class="card-header">
    <h4 class="card-title">{{ vm.mode }}</h4>
  </div>
  <div class="list-group">
    <div ng-if="filtered.length > 0" class="list-group-item hidden-xs">
      <div class="flex-row">
        <div ng-if="vm.mode !== 'CAN'" class="col-sm-3 col-xs-12">
          <label class="small" translate>Name</label>
        </div>
        <div class="col-sm-3 col-xs-12">
          <label class="small" translate>Device type</label>
        </div>
        <div
          ng-if="vm.mode !== 'CAN' && vm.mode !== 'Profibus' && vm.mode !=='CANopen'"
          class="col-sm-2 col-xs-12"
        >
          <label class="small" translate>Address</label>
        </div>
        <div ng-if="vm.mode ==='CANopen'" class="col-sm-2 col-xs-12">
          <label class="small" translate>Node ID</label>
        </div>
        <div ng-if="vm.mode === 'TCP'" class="col-sm-3 col-xs-12">
          <label class="small" translate>IP address</label>
        </div>
      </div>
    </div>
    <div
      class="list-group-item"
      ng-repeat="device in vm.devices | orderBy:'name' | filter:vm.filterByMode() as filtered"
    >
      <div class="flex-row">
        <div
          ng-if="vm.mode !== 'CAN'"
          class="col-sm-3 col-xs-12 interact"
          ng-click="vm.navigateToDetail(device)"
        >
          <label class="small visible-xs-inline-block" translate>
            Name
          </label>
          {{ device.name }}
        </div>
        <div class="col-sm-3 col-xs-12">
          <label class="small visible-xs-inline-block" translate>
            Device type
          </label>
          {{ device.deviceType }}
        </div>
        <div
          ng-if="vm.mode !== 'CAN' && vm.mode !== 'Profibus' && vm.mode !=='CANopen'"
          class="col-sm-2 col-xs-12"
        >
          <label class="small visible-xs-inline-block" translate>
            Address
          </label>
          {{ device.address }}
        </div>
        <div ng-if="vm.mode ==='CANopen'" class="col-sm-2 col-xs-12">
          <label class="small visible-xs-inline-block" translate>
            Node ID
          </label>
          {{ device.nodeId }}
        </div>
        <div ng-if="vm.mode === 'TCP'" class="col-sm-3 col-xs-12">
          <label class="small visible-xs-inline-block" translate>
            IP address
          </label>
          {{ device.ipAddress }}
        </div>
        <div class="col-sm-1 col-xs-12 text-right showOnHover">
          <button
            class="btn btn-link"
            title="{{ 'Remove' | translate }}"
            ng-click="vm.onClickDelete(device)"
          >
            <i c8y-icon="minus-circle" class="text-danger"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <c8y-load-more ng-repeat-end change-page-size></c8y-load-more>

  <form
    ng-if="vm.newDevice"
    class="bg-gray-lighter"
    name="vm.new{{ vm.mode }}DeviceForm"
    novalidate
  >
    <div class="card-block">
      <div
        ng-if="vm.mode !== 'CAN'"
        class="form-group"
        ng-class="{'has-error': vm.invalid('name')}"
        uib-tooltip="{{ vm.getFieldValidationHints('name') }}"
      >
        <input
          class="form-control"
          name="name"
          placeholder="{{ 'Name' | translate }}"
          ng-model="vm.newDevice.name"
          ng-disabled="vm.newDevice.adding"
          required
        />
      </div>
      <div
        class="form-group"
        ng-class="{'has-error': vm.invalid('deviceType')}"
        uib-tooltip="{{ vm.getFieldValidationHints('deviceType') }}"
      >
        <ui-select
          class="form-control"
          name="deviceType"
          append-to-body="true"
          ng-model="vm.newDevice.deviceType"
          ng-disabled="vm.newDevice.adding"
          required
        >
          <ui-select-match
            placeholder="{{ 'Select a device protocol…' | translate }}"
            title="{{ $select.selected.name }}"
            ng-bind="$select.selected.name"
          >
          </ui-select-match>
          <ui-select-choices
            repeat="type in vm.deviceConfigurationOptions.types | orderBy:'name' | filter:$select.search"
          >
            <span title="{{ type.name }}">{{ type.name }}</span>
          </ui-select-choices>
        </ui-select>
      </div>

      <div
        ng-if="vm.mode !== 'CAN' && vm.mode !== 'Profibus' && vm.mode !== 'CANopen'"
        class="form-group"
        ng-class="{'has-error': vm.invalid('address')}"
        uib-tooltip="{{ vm.getFieldValidationHints('address') }}"
      >
        <input
          class="form-control"
          type="number"
          name="address"
          placeholder="{{ 'Address' | translate }}"
          ng-model="vm.newDevice.address"
          ng-min="0"
          ng-max="255"
          step="1"
          required
          ng-disabled="vm.newDevice.adding"
        />
      </div>

      <div
        ng-if="vm.mode === 'CANopen'"
        class="form-group"
        ng-class="{'has-error': vm.invalid('nodeId')}"
        uib-tooltip="{{ vm.getFieldValidationHints('nodeId') }}"
      >
        <input
          class="form-control"
          type="number"
          name="nodeId"
          placeholder="{{ 'Node ID' | translate }}"
          ng-model="vm.newDevice.nodeId"
          step="1"
          required
          ng-disabled="vm.newDevice.adding"
        />
      </div>

      <div
        class="form-group"
        ng-if="vm.mode === 'TCP'"
        ng-class="{'has-error': vm.invalid('ipAddress')}"
        uib-tooltip="{{ vm.getFieldValidationHints('ipAddress') }}"
      >
        <input
          class="form-control"
          id="ipAddress"
          name="ipAddress"
          ng-model="vm.newDevice.ipAddress"
          placeholder="{{ 'IP address' | translate }}"
          validate-ip
          maxlength="15"
          required
          ng-disabled="vm.newDevice.adding"
        />
      </div>

      <button
        title="{{ 'Cancel' | translate }}"
        class="btn btn-default"
        ng-click="vm.clearNewDevice()"
        ng-disabled="vm.newDevice.adding"
        translate
      >
        Cancel
      </button>

      <button
        class="btn btn-primary"
        ng-class="{'btn-pending': vm.newDevice.adding}"
        ng-click="vm.addNewDevice()"
        ng-disabled="vm.isFormInvalid() || vm.newDevice.adding"
      >
        <span title="{{ 'Add' | translate }}" ng-if="!vm.newDevice.adding">
          {{ 'Add' | translate }}
        </span>
        <span ng-if="vm.newDevice.adding"> {{ 'Adding' | translate }}… </span>
      </button>
    </div>
  </form>

  <div class="card-footer separator">
    <button
      title="{{ 'Add device' | translate }}"
      class="btn-add-block"
      ng-click="vm.startAddingNewDevice()"
    >
      <i c8y-icon="plus-circle"></i>
      <span translate>Add {{ vm.mode }} device</span>
    </button>
  </div>
</div>

<div ng-if="vm.isOPCUATab()" class="card">
  <div class="card-header">
    <h4 translate>OPC UA devices</h4>
  </div>

  <div class="list-group">
    <div class="list-group-item hidden-xs hidden-sm">
      <div class="flex-row row">
        <div class="col-sm-4">
          <label class="small" translate>Name</label>
        </div>
        <div class="col-sm-3">
          <label class="small" translate>Directory path</label>
        </div>
        <div class="col-sm-3">
          <label class="small" translate>Device type</label>
        </div>
      </div>
    </div>
    <div
      class="list-group-item"
      ng-repeat="device in vm.devices | filter:vm.filterByMode() | orderBy:'-'"
    >
      <div class="flex-row row">
        <div class="col-sm-4 col-xs-12">
          <label class="small hidden-md hidden-lg" translate>Name</label>
          <a href="" ng-click="vm.navigateToDetail(device)">
            {{ device.name }}
          </a>
        </div>
        <div class="col-sm-3 col-xs-12">
          <label class="small hidden-md hidden-lg" translate>Directory path</label>
          <small class="text-muted">{{ device.directoryPath }}</small>
        </div>
        <div class="col-sm-3 col-xs-12">
          <label class="small hidden-md hidden-lg" translate>Device type</label>
          <small>{{ device.deviceType }}</small>
        </div>
        <div class="col-sm-2 col-xs-12 text-right showOnHover">
          <button
            class=" btn btn-link"
            title="{{ 'Remove' | translate }}"
            ng-click="vm.onClickDelete(device)"
          >
            <i c8y-icon="minus-circle" class="text-danger"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <c8y-load-more ng-repeat-end change-page-size></c8y-load-more>

  <form ng-if="vm.newDevice" class="bg-gray-lighter" name="vm.newOPCUADeviceForm" novalidate>
    <div class="card-block">
      <div
        class="form-group"
        ng-class="{'has-error': vm.invalid('name')}"
        uib-tooltip="{{ vm.getFieldValidationHints('name') }}"
      >
        <input
          class="form-control input-border"
          placeholder="{{ 'Name' | translate }}"
          name="name"
          ng-model="vm.newDevice.name"
          required
          ng-disabled="vm.newDevice.adding"
        />
      </div>
      <div
        class="form-group"
        ng-class="{'has-error': vm.invalid('directoryPath')}"
        uib-tooltip="{{ vm.getFieldValidationHints('directoryPath') }}"
      >
        <input
          class="form-control input-border"
          placeholder="{{ 'Directory path' | translate }}"
          name="directoryPath"
          ng-model="vm.newDevice.directoryPath"
          required
          ng-disabled="vm.newDevice.adding"
        />
      </div>
      <div
        class="form-group"
        ng-class="{'has-error': vm.invalid('deviceType')}"
        uib-tooltip="{{ vm.getFieldValidationHints('deviceType') }}"
      >
        <ui-select
          class="form-control"
          name="deviceType"
          append-to-body="true"
          ng-model="vm.newDevice.deviceType"
          required
          ng-disabled="vm.newDevice.adding"
        >
          <ui-select-match title="{{ $select.selected.name }}" ng-bind="$select.selected.name">
          </ui-select-match>
          <ui-select-choices
            repeat="type in vm.deviceConfigurationOptions.types | orderBy:'name' | filter:$select.search"
          >
            <span title="{{ type.name }}">{{ type.name }}</span>
          </ui-select-choices>
        </ui-select>
      </div>
      <button
        title="{{ 'Cancel' | translate }}"
        class="btn btn-default"
        ng-click="vm.clearNewDevice()"
        ng-disabled="vm.newDevice.adding"
        translate
      >
        Cancel
      </button>

      <button
        class="btn btn-primary"
        ng-class="{'btn-pending': vm.newDevice.adding}"
        ng-click="vm.addNewDevice()"
        ng-disabled="vm.isFormInvalid() || vm.newDevice.adding"
      >
        <span title="{{ 'Add' | translate }}" ng-if="!vm.newDevice.adding">
          {{ 'Add' | translate }}
        </span>
        <span ng-if="vm.newDevice.adding"> {{ 'Adding' | translate }}… </span>
      </button>
    </div>
  </form>
  <div class="card-footer separator">
    <button
      title="{{ 'Add OPC UA device' | translate }}"
      class="btn-add-block"
      style="margin-bottom:0;"
      ng-click="vm.startAddingNewDevice()"
    >
      <i c8y-icon="plus-circle"></i>
      <span translate>Add OPC UA device</span>
    </button>
  </div>
</div>

<div ng-if="vm.isSNMPTab()" class="card">
  <div class="card-header">
    <h4 translate>SNMP devices</h4>
  </div>
  <div class="list-group">
    <div class="list-group-item flex-row collapsible hidden-xs hidden-sm">
      <div class="list-item-actions"></div>
      <div class="list-item-body">
        <div class="flex-row row">
          <div class="col-sm-3">
            <label class="small" translate>Name</label>
          </div>
          <div class="col-sm-3">
            <label class="small" translate>Device type</label>
          </div>
          <div class="col-sm-4">
            <label class="small" translate>IP address:Port</label>
          </div>
          <div class="col-sm-2">
            <label class="small" translate>SNMP version</label>
          </div>
        </div>
      </div>
    </div>

    <div
      ng-repeat="device in vm.devices"
      class="list-group-item flex-row collapsible"
      ng-class="{'expanded': device.id === vm.expandedId}"
    >
      <div class="list-item-actions">
        <button
          class=" btn btn-dot showOnHover"
          title="{{ 'Remove' | translate }}"
          ng-click="vm.onClickDelete(device)"
        >
          <i c8y-icon="minus-circle" class="text-danger"></i>
        </button>
        <button
          type="button"
          title="{{ 'Expand/collapse' | translate }}"
          class="collapse-btn"
          ng-click="vm.toggle(device.id)"
        >
          <i c8y-icon="chevron-down"></i>
        </button>
      </div>

      <div class="list-item-body">
        <div class="flex-row row">
          <div class="col-sm-3 col-xs-12">
            <label class="small hidden-md hidden-lg" translate>Name</label>
            <a title="{{ device.name }}" href="" ng-click="vm.navigateToDetail(device)">
              {{ device.name }}
            </a>
          </div>
          <div class="col-sm-3 col-xs-12">
            <label class="small hidden-md hidden-lg" translate>Device type</label>
            <small class="text-muted">{{ device.deviceType }}</small>
          </div>
          <div class="col-sm-4 col-xs-12">
            <label class="small hidden-md hidden-lg" translate>IP address:Port</label>
            <small>{{ device.ipAddress }}:{{ device.port }}</small>
          </div>

          <div class="col-sm-2 col-xs-12">
            <label class="small hidden-md hidden-lg" translate>SNMP version</label>
            <small ng-bind="vm.getSnmpVersionLabel(device.version)"></small>
          </div>
        </div>
      </div>

      <div class="collapse" uib-collapse="!(device.id === vm.expandedId)">
        <form
          ng-if="device.id === vm.expandedId"
          class="top-m-sm"
          data-ng-init="editDevice = vm.startEditDevice(device)"
          name="{{ vm.getFormName(editDevice) }}"
          novalidate
        >
          <div
            class="form-group"
            ng-class="{'has-error': vm.invalid('name',vm.getDeviceFormName(editDevice))}"
            uib-tooltip="{{ vm.getFieldValidationHints('name', vm.getDeviceFormName(editDevice)) }}"
          >
            <label translate>Name</label>
            <input
              class="form-control"
              placeholder="{{ 'e.g. SNMP device 1' | translate }}"
              name="name"
              ng-model="editDevice.name"
              required
              ng-disabled="editDevice.adding"
            />
          </div>
          <div
            class="form-group"
            ng-class="{'has-error': vm.invalid('deviceType', vm.getDeviceFormName(editDevice))}"
            uib-tooltip="{{
              vm.getFieldValidationHints('deviceType', vm.getDeviceFormName(editDevice))
            }}"
          >
            <label translate>Device type</label>
            <ui-select
              class="form-control"
              name="deviceType"
              append-to-body="true"
              ng-model="editDevice.deviceType"
              required
              ng-disabled="editDevice.adding"
            >
              <ui-select-match
                placeholder="{{ 'Select device protocol' | translate }}"
                title="{{ $select.selected.name }}"
                ng-bind="$select.selected.name || editDevice.deviceType.name"
              >
              </ui-select-match>
              <ui-select-choices
                repeat="type in vm.deviceConfigurationOptions.types | orderBy:'name' | filter:$select.search"
              >
                <span title="{{ type.name }}">{{ type.name }}</span>
              </ui-select-choices>
            </ui-select>
          </div>
          <div class="tight-grid">
            <div class="col-sm-8">
              <div
                class="form-group"
                ng-class="{'has-error': vm.invalid('ipAddress',vm.getDeviceFormName(editDevice))}"
                uib-tooltip="{{
                  vm.getFieldValidationHints('ipAddress', vm.getDeviceFormName(editDevice))
                }}"
              >
                <label translate>IP address</label>
                <input
                  class="form-control"
                  placeholder="{{ 'e.g.' | translate }} 162.12.24.1"
                  name="ipAddress"
                  validate-ip
                  ng-model="editDevice.ipAddress"
                  required
                  ng-disabled="editDevice.adding"
                  allow-ip-v6="true"
                />
              </div>
            </div>
            <div class="col-sm-4">
              <div
                class="form-group"
                ng-class="{'has-error': vm.invalid('port', vm.getDeviceFormName(editDevice))}"
                uib-tooltip="{{
                  vm.getFieldValidationHints('port', vm.getDeviceFormName(editDevice))
                }}"
              >
                <label translate>Port</label>
                <input
                  class="form-control"
                  placeholder="{{ 'e.g.' | translate }} 161"
                  name="port"
                  ng-model="editDevice.port"
                  required
                  ng-disabled="editDevice.adding"
                />
              </div>
            </div>
          </div>
          <div
            class="form-group"
            ng-class="{'has-error': vm.invalid('version', vm.getDeviceFormName(editDevice))}"
            uib-tooltip="{{
              vm.getFieldValidationHints('version', vm.getDeviceFormName(editDevice))
            }}"
          >
            <label translate>SNMP version</label>
            <ui-select
              class="form-control"
              name="deviceType"
              append-to-body="true"
              ng-model="editDevice.version"
              required
              ng-disabled="editDevice.adding"
            >
              <ui-select-match
                placeholder="{{ 'Select SNMP version' | translate }}"
                title="{{ $select.selected.label | translate }}"
                ng-bind="$select.selected.label | translate"
              >
              </ui-select-match>
              <ui-select-choices
                repeat="version.value as version in vm.snmpVersions | orderBy:'label' | filter:$select.search"
              >
                <span title="{{ version.label | translate }}">{{ version.label | translate }}</span>
              </ui-select-choices>
            </ui-select>
          </div>
          <fieldset ng-if="editDevice.version === vm.snmpVersions.VERSION_3.value">
            <div class="legend form-block" translate>
              Device authentication details
            </div>
            <div class="tight-grid">
              <div class="col-sm-6">
                <div
                  class="form-group"
                  ng-class="{'has-error': vm.invalid('snmpVersionUsername',vm.getDeviceFormName(editDevice))}"
                  uib-tooltip="{{
                    vm.getFieldValidationHints(
                      'snmpVersionUsername',
                      vm.getDeviceFormName(editDevice)
                    )
                  }}"
                >
                  <label translate>Username</label>
                  <input
                    class="form-control"
                    placeholder="{{ 'e.g. my_username' | translate }}"
                    name="snmpVersionUsername"
                    ng-model="editDevice.auth.username"
                    required
                    ng-disabled="editDevice.adding"
                  />
                </div>
              </div>
              <div class="col-sm-6">
                <div
                  class="form-group"
                  ng-class="{'has-error': vm.invalid('snmpVersionSecurityLevel',vm.getDeviceFormName(editDevice))}"
                  uib-tooltip="{{
                    vm.getFieldValidationHints(
                      'snmpVersionSecurityLevel',
                      vm.getDeviceFormName(editDevice)
                    )
                  }}"
                >
                  <label translate>Security level</label>
                  <ui-select
                    class="form-control"
                    name="snmpVersionSecurityLevel"
                    append-to-body="true"
                    ng-model="editDevice.auth.securityLevel"
                    required
                    ng-disabled="editDevice.adding"
                  >
                    <ui-select-match
                      placeholder="{{ 'Select security level' | translate }}"
                      title="{{ $select.selected.label | translate }}"
                      ng-bind="$select.selected.label | translate"
                    >
                    </ui-select-match>
                    <ui-select-choices
                      repeat="level.value as level in vm.snmpSecurityLevels | orderBy:'label' | filter:$select.search"
                    >
                      <span title="{{ level.label | translate }}">{{
                        level.label | translate
                      }}</span>
                    </ui-select-choices>
                  </ui-select>
                </div>
              </div>
            </div>
            <div class="tight-grid">
              <div class="col-sm-6">
                <div
                  class="form-group"
                  ng-class="{'has-error': vm.invalid('snmpVersionEngineId',vm.getDeviceFormName(editDevice))}"
                  uib-tooltip="{{
                    vm.getFieldValidationHints(
                      'snmpVersionEngineId',
                      vm.getDeviceFormName(editDevice)
                    )
                  }}"
                >
                  <label translate>Engine ID</label>
                  <input
                    class="form-control"
                    placeholder="{{ 'e.g.' | translate }} 45:U9:39:900:FJ8"
                    name="snmpVersionEngineId"
                    ng-model="editDevice.auth.engineId"
                    ng-minlength="5"
                    ng-maxlength="32"
                    required
                    ng-disabled="editDevice.adding || {{ !!editDevice.auth.engineId }}"
                  />
                </div>
              </div>
            </div>
            <fieldset
              ng-if="editDevice.auth.securityLevel === vm.snmpSecurityLevels.AUTH_NOPRIV.value || editDevice.auth.securityLevel === vm.snmpSecurityLevels.AUTH_PRIV.value "
            >
              <div class="legend form-block" translate>
                Authentication
              </div>
              <div class="tight-grid">
                <div class="col-sm-6">
                  <div
                    class="form-group"
                    ng-class="{'has-error': vm.invalid('snmpVersionAuthProtocol',vm.getDeviceFormName(editDevice))}"
                    uib-tooltip="{{
                      vm.getFieldValidationHints(
                        'snmpVersionAuthProtocol',
                        vm.getDeviceFormName(editDevice)
                      )
                    }}"
                  >
                    <label translate>Protocol</label>
                    <ui-select
                      class="form-control"
                      name="snmpVersionAuthProtocol"
                      append-to-body="true"
                      ng-model="editDevice.auth.authProtocol"
                      required
                      ng-disabled="editDevice.adding"
                    >
                      <ui-select-match
                        placeholder="{{ 'Select protocol' | translate }}"
                        title="{{ $select.selected.label | translate }}"
                        ng-bind="$select.selected.label | translate"
                      >
                      </ui-select-match>
                      <ui-select-choices
                        repeat="protocol.value as protocol in vm.snmpAuthProtocols | orderBy:'label' | filter:$select.search"
                      >
                        <span title="{{ protocol.label | translate }}">{{
                          protocol.label | translate
                        }}</span>
                      </ui-select-choices>
                    </ui-select>
                  </div>
                </div>
                <div class="col-sm-6">
                  <div
                    class="form-group"
                    ng-class="{'has-error': vm.invalid('snmpVersionAuthPassword',vm.getDeviceFormName(editDevice))}"
                    uib-tooltip="{{
                      vm.getFieldValidationHints(
                        'snmpVersionAuthPassword',
                        vm.getDeviceFormName(editDevice)
                      )
                    }}"
                  >
                    <label translate>Password</label>
                    <input
                      class="form-control"
                      type="password"
                      placeholder="{{ 'e.g. my_password' | translate }}"
                      name="snmpVersionAuthPassword"
                      ng-minlength="8"
                      ng-model="editDevice.auth.authPassword"
                      required
                      ng-disabled="editDevice.adding"
                    />
                  </div>
                </div>
              </div>
            </fieldset>
            <fieldset
              ng-if="editDevice.auth.securityLevel === vm.snmpSecurityLevels.AUTH_PRIV.value "
            >
              <div class="legend form-block" translate>
                Privacy
              </div>
              <div class="tight-grid">
                <div class="col-sm-6">
                  <div
                    class="form-group"
                    ng-class="{'has-error': vm.invalid('snmpVersionAuthPrivProtocol',vm.getDeviceFormName(editDevice))}"
                    uib-tooltip="{{
                      vm.getFieldValidationHints(
                        'snmpVersionAuthPrivProtocol',
                        vm.getDeviceFormName(editDevice)
                      )
                    }}"
                  >
                    <label translate>Protocol</label>
                    <ui-select
                      class="form-control"
                      name="snmpVersionAuthPrivProtocol"
                      append-to-body="true"
                      ng-model="editDevice.auth.privProtocol"
                      required
                      ng-disabled="editDevice.adding"
                    >
                      <ui-select-match
                        placeholder="{{ 'Select protocol' | translate }}"
                        title="{{ $select.selected.label | translate }}"
                        ng-bind="$select.selected.label | translate"
                      >
                      </ui-select-match>
                      <ui-select-choices
                        repeat="protocol.value as protocol in vm.snmpAuthPrivProtocols | orderBy:'label' | filter:$select.search"
                      >
                        <span title="{{ protocol.label | translate }}">{{
                          protocol.label | translate
                        }}</span>
                      </ui-select-choices>
                    </ui-select>
                  </div>
                </div>
                <div class="col-sm-6">
                  <div
                    class="form-group"
                    ng-class="{'has-error': vm.invalid('snmpVersionAuthPrivPassword',vm.getDeviceFormName(editDevice))}"
                    uib-tooltip="{{
                      vm.getFieldValidationHints(
                        'snmpVersionAuthPrivPassword',
                        vm.getDeviceFormName(editDevice)
                      )
                    }}"
                  >
                    <label translate>Password</label>
                    <input
                      class="form-control"
                      type="password"
                      placeholder="{{ 'e.g. my_password' | translate }}"
                      ng-minlength="8"
                      name="snmpVersionAuthPrivPassword"
                      ng-model="editDevice.auth.privPassword"
                      required
                      ng-disabled="editDevice.adding"
                    />
                  </div>
                </div>
              </div>
            </fieldset>
          </fieldset>
          <div class="form-group">
            <button
              title="{{ 'Cancel' | translate }}"
              class="btn btn-default"
              ng-click="vm.clearEditDevice()"
              ng-disabled="editDevice.adding"
              translate
            >
              Cancel
            </button>
            <button
              class="btn btn-primary"
              ng-class="{'btn-pending': editDevice.adding}"
              ng-click="vm.updateDevice(editDevice)"
              ng-disabled="vm.isEditFormInvalid(vm.getDeviceFormName(editDevice), editDevice) || editDevice.adding"
            >
              <span title="{{ 'Save' | translate }}" ng-if="!editDevice.adding">
                {{ 'Save' | translate }}
              </span>
              <span ng-if="editDevice.adding"> {{ 'Saving' | translate }}&hellip; </span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <form
    ng-if="vm.newDevice && vm.expandedId === 'newDevice'"
    class="card-block bg-gray-lighter"
    name="vm.newSNMPDeviceForm"
    novalidate
  >
    <div
      class="form-group"
      ng-class="{'has-error': vm.invalid('name')}"
      uib-tooltip="{{ vm.getFieldValidationHints('name') }}"
    >
      <label translate>Name</label>
      <input
        class="form-control"
        placeholder="{{ 'e.g. SNMP device 1' | translate }}"
        name="name"
        ng-model="vm.newDevice.name"
        required
        ng-disabled="vm.newDevice.adding"
      />
    </div>
    <div
      class="form-group"
      ng-class="{'has-error': vm.invalid('deviceType')}"
      uib-tooltip="{{ vm.getFieldValidationHints('deviceType') }}"
    >
      <label translate>Device type</label>
      <ui-select
        class="form-control"
        name="deviceType"
        append-to-body="true"
        ng-model="vm.newDevice.deviceType"
        required
        ng-disabled="vm.newDevice.adding"
      >
        <ui-select-match
          placeholder="{{ 'Select device protocol' | translate }}"
          title="{{ $select.selected.name }}"
          ng-bind="$select.selected.name"
        >
        </ui-select-match>
        <ui-select-choices
          repeat="type in vm.deviceConfigurationOptions.types | orderBy:'name' | filter:$select.search"
        >
          <span title="{{ type.name }}">{{ type.name }}</span>
        </ui-select-choices>
      </ui-select>
    </div>
    <div class="tight-grid">
      <div class="col-sm-8">
        <div
          class="form-group"
          ng-class="{'has-error': vm.invalid('ipAddress')}"
          uib-tooltip="{{ vm.getFieldValidationHints('ipAddress') }}"
        >
          <label translate>IP address</label>
          <input
            class="form-control"
            placeholder="{{ 'e.g.' | translate }} 162.12.24.1"
            name="ipAddress"
            validate-ip
            ng-model="vm.newDevice.ipAddress"
            required
            ng-disabled="vm.newDevice.adding"
            allow-ip-v6="true"
          />
        </div>
      </div>
      <div class="col-sm-4">
        <div
          class="form-group"
          ng-class="{'has-error': vm.invalid('port')}"
          uib-tooltip="{{ vm.getFieldValidationHints('port') }}"
        >
          <label translate>Port</label>
          <input
            class="form-control"
            placeholder="{{ 'e.g.' | translate }} 161"
            name="port"
            ng-model="vm.newDevice.port"
            required
            ng-disabled="vm.newDevice.adding"
          />
        </div>
      </div>
    </div>
    <div
      class="form-group"
      ng-class="{'has-error': vm.invalid('version')}"
      uib-tooltip="{{ vm.getFieldValidationHints('version') }}"
    >
      <label translate>SNMP version</label>
      <ui-select
        class="form-control"
        name="deviceType"
        append-to-body="true"
        ng-model="vm.newDevice.version"
        required
        ng-disabled="vm.newDevice.adding"
      >
        <ui-select-match
          placeholder="{{ 'Select SNMP version' | translate }}"
          title="{{ $select.selected.label | translate }}"
          ng-bind="$select.selected.label | translate"
        >
        </ui-select-match>
        <ui-select-choices
          repeat="version.value as version in vm.snmpVersions | orderBy:'label' | filter:$select.search"
        >
          <span title="{{ version.label | translate }}">{{ version.label | translate }}</span>
        </ui-select-choices>
      </ui-select>
    </div>
    <fieldset ng-if="vm.newDevice.version === vm.snmpVersions.VERSION_3.value">
      <div class="legend form-block" translate>
        Device authentication details
      </div>
      <div class="tight-grid">
        <div class="col-sm-6">
          <div
            class="form-group"
            ng-class="{'has-error': vm.invalid('snmpVersionUsername')}"
            uib-tooltip="{{ vm.getFieldValidationHints('snmpVersionUsername') }}"
          >
            <label translate>Username</label>
            <input
              class="form-control"
              placeholder="{{ 'e.g. my_username' | translate }}"
              name="snmpVersionUsername"
              ng-model="vm.newDevice.auth.username"
              required
              ng-disabled="vm.newDevice.adding"
            />
          </div>
        </div>
        <div class="col-sm-6">
          <div
            class="form-group"
            ng-class="{'has-error': vm.invalid('snmpVersionSecurityLevel')}"
            uib-tooltip="{{ vm.getFieldValidationHints('snmpVersionSecurityLevel') }}"
          >
            <label translate>Security level</label>
            <ui-select
              class="form-control"
              name="snmpVersionSecurityLevel"
              append-to-body="true"
              ng-model="vm.newDevice.auth.securityLevel"
              required
              ng-disabled="vm.newDevice.adding"
            >
              <ui-select-match
                placeholder="{{ 'Select security level' | translate }}"
                title="{{ $select.selected.label | translate }}"
                ng-bind="$select.selected.label | translate"
              >
              </ui-select-match>
              <ui-select-choices
                repeat="level.value as level in vm.snmpSecurityLevels | orderBy:'name' | filter:$select.search"
              >
                <span title="{{ level.label | translate }}">{{ level.label | translate }}</span>
              </ui-select-choices>
            </ui-select>
          </div>
        </div>
      </div>
      <div class="tight-grid">
        <div class="col-sm-6">
          <div
            class="form-group"
            ng-class="{'has-error': vm.invalid('snmpVersionEngineId')}"
            uib-tooltip="{{ vm.getFieldValidationHints('snmpVersionEngineId') }}"
          >
            <label translate>Engine ID</label>
            <input
              class="form-control"
              placeholder="{{ 'e.g.' | translate }} 45:U9:39:900:FJ8"
              name="snmpVersionEngineId"
              ng-model="vm.newDevice.auth.engineId"
              ng-minlength="5"
              ng-maxlength="32"
              required
              ng-disabled="vm.newDevice.adding"
            />
          </div>
        </div>
      </div>
      <fieldset
        ng-if="vm.newDevice.auth.securityLevel === vm.snmpSecurityLevels.AUTH_NOPRIV.value || vm.newDevice.auth.securityLevel === vm.snmpSecurityLevels.AUTH_PRIV.value "
      >
        <div class="legend form-block" translate>
          Authentication
        </div>
        <div class="tight-grid">
          <div class="col-sm-6">
            <div
              class="form-group"
              ng-class="{'has-error': vm.invalid('snmpVersionAuthProtocol')}"
              uib-tooltip="{{ vm.getFieldValidationHints('snmpVersionAuthProtocol') }}"
            >
              <label translate>Protocol</label>
              <ui-select
                class="form-control"
                name="snmpVersionAuthProtocol"
                append-to-body="true"
                ng-model="vm.newDevice.auth.authProtocol"
                required
                ng-disabled="vm.newDevice.adding"
              >
                <ui-select-match
                  placeholder="{{ 'Select protocol' | translate }}"
                  title="{{ $select.selected.label | translate }}"
                  ng-bind="$select.selected.label | translate"
                >
                </ui-select-match>
                <ui-select-choices
                  repeat="protocol.value as protocol in vm.snmpAuthProtocols | orderBy:'label' | filter:$select.search"
                >
                  <span title="{{ protocol.label | translate }}">{{
                    protocol.label | translate
                  }}</span>
                </ui-select-choices>
              </ui-select>
            </div>
          </div>
          <div class="col-sm-6">
            <div
              class="form-group"
              ng-class="{'has-error': vm.invalid('snmpVersionAuthPassword')}"
              uib-tooltip="{{ vm.getFieldValidationHints('snmpVersionAuthPassword') }}"
            >
              <label translate>Password</label>
              <input
                class="form-control"
                type="password"
                ng-minlength="8"
                placeholder="{{ 'e.g. my_password' | translate }}"
                name="snmpVersionAuthPassword"
                ng-model="vm.newDevice.auth.authPassword"
                required
                ng-disabled="vm.newDevice.adding"
              />
            </div>
          </div>
        </div>
      </fieldset>
      <fieldset ng-if="vm.newDevice.auth.securityLevel === vm.snmpSecurityLevels.AUTH_PRIV.value ">
        <div class="legend form-block" translate>
          Privacy
        </div>
        <div class="tight-grid">
          <div class="col-sm-6">
            <div
              class="form-group"
              ng-class="{'has-error': vm.invalid('snmpVersionAuthPrivProtocol')}"
              uib-tooltip="{{ vm.getFieldValidationHints('snmpVersionAuthPrivProtocol') }}"
            >
              <label translate>Protocol</label>
              <ui-select
                class="form-control"
                name="snmpVersionAuthPrivProtocol"
                append-to-body="true"
                ng-model="vm.newDevice.auth.privProtocol"
                required
                ng-disabled="vm.newDevice.adding"
              >
                <ui-select-match
                  placeholder="{{ 'Select protocol' | translate }}"
                  title="{{ $select.selected.label | translate }}"
                  ng-bind="$select.selected.label | translate"
                >
                </ui-select-match>
                <ui-select-choices
                  repeat="protocol.value as protocol in vm.snmpAuthPrivProtocols | orderBy:'label' | filter:$select.search"
                >
                  <span title="{{ protocol.label | translate }}">{{
                    protocol.label | translate
                  }}</span>
                </ui-select-choices>
              </ui-select>
            </div>
          </div>
          <div class="col-sm-6">
            <div
              class="form-group"
              ng-class="{'has-error': vm.invalid('snmpVersionAuthPrivPassword')}"
              uib-tooltip="{{ vm.getFieldValidationHints('snmpVersionAuthPrivPassword') }}"
            >
              <label translate>Password</label>
              <input
                class="form-control"
                ng-minlength="8"
                type="password"
                placeholder="{{ 'e.g. my_password' | translate }}"
                name="snmpVersionAuthPrivPassword"
                ng-model="vm.newDevice.auth.privPassword"
                required
                ng-disabled="vm.newDevice.adding"
              />
            </div>
          </div>
        </div>
      </fieldset>
    </fieldset>

    <div class="form-group">
      <button
        title="{{ 'Cancel' | translate }}"
        class="btn btn-default"
        ng-click="vm.clearNewDevice()"
        ng-disabled="vm.newDevice.adding"
        translate
      >
        Cancel
      </button>
      <button
        class="btn btn-primary"
        ng-class="{'btn-pending': vm.newDevice.adding}"
        ng-click="vm.addNewDevice()"
        ng-disabled="vm.isFormInvalid() || vm.newDevice.adding"
      >
        <span title="{{ 'Add' | translate }}" ng-if="!vm.newDevice.adding">
          {{ 'Add' | translate }}
        </span>
        <span ng-if="vm.newDevice.adding"> {{ 'Adding' | translate }}… </span>
      </button>
    </div>
  </form>
  <div class="card-footer separator" ng-hide="vm.expandedId === 'newDevice'">
    <button
      title="{{ 'Add SNMP device' | translate }}"
      class="btn-add-block"
      style="margin-bottom:0;"
      ng-click="vm.startAddingNewDevice();"
    >
      <i c8y-icon="plus-circle"></i> {{ 'Add SNMP device' | translate }}
    </button>
  </div>
  <c8y-load-more ng-repeat-end change-page-size></c8y-load-more>
</div>
