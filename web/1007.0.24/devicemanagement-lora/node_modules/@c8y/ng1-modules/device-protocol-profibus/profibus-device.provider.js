"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?Object(arguments[e]):{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(){e.$inject=["c8yDeviceTypeProtocolBaseProvider","c8yDeviceProtocolUiProvider","c8yViewsProvider","gettext"];var a="c8yProfibusDevice";function e(e,t,r,i){n.$inject=["c8yDeviceDatabase","c8yDeviceControl","c8yModbusDevice","gettextCatalog","c8yDevices","c8yBase","c8yUser","$q"];var s={label:i("Profibus"),fieldbusType:"profibus",serviceName:a};return e.getDeviceTypeProtocolProvider(s,n);function n(e,g,p,t,u,o,a,m){var r=_objectSpread({},s,{discreteOutputs:!1,discreteInputs:!1,holdingRegisters:{sectionTitle:i("Registers"),noRegistersDefinedMessage:i("No registers defined."),elementTypeLabel:i("Register"),newRegisterModalTitle:i("New register"),editRegisterModalTitle:i('Edit register: "{{name}}"'),addRegisterButtonLabel:i("Add register"),validation:{invalidName:i("Name must be unique among registers."),invalidMeasurement:i("Selected measurement type and series are already used by another register.")},number:!0,startBit:{max:63},noBits:{max:64},multiplier:{min:1,step:1},divisor:!0,decimalPlaces:!0,unit:!0,options:{signed:!0,enumType:!0},functionalities:{readWriteMutex:!0,sendMeasurement:!0,raiseAlarm:!0,sendEvent:!0}},inputRegisters:!1,options:{serverTime:!0},deviceFragments:["c8y_ProfibusDevice"],deviceConfiguration:{fragment:"c8y_ProfibusConfiguration",icon:"ravelry"}});return{registerFeaturesManifest:function(){e.registerFeaturesManifest(n().then(function(e){return e&&r}))},updateElement:function(c,u,o){var d,l,v;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.canUpdateElement(c,u))return void 0,r=(t={device:c,register:u,valueMap:o}).device,n=t.register,i=t.valueMap,a=i.label||i.value,s=!i.label&&n.unit?" ".concat(n.unit):"",d={deviceId:r.id,description:'Change value of "'.concat(n.name,'" to ').concat(a).concat(s,"."),c8y_SetRegister:{address:r.c8y_RegisterStatus.ProfibusSlave_Address,register:n.number,startBit:n.startBit,noBits:n.noBits,value:i.value}},u.changePending=!0,l=p.getAlertMessagesFns(u,o),e.next=6,regeneratorRuntime.awrap(p.sendOperationAndGetResult(d,l));e.next=9;break;case 6:return(v=e.sent).status===g.status.SUCCESSFUL?(_.set(c,["c8y_RegisterStatus",u.name],o.value),u.changePending=!1):v.status===g.status.FAILED&&(u.changePending=!1),e.abrupt("return",v);case 9:return e.abrupt("return",m.reject());case 10:case"end":return e.stop()}var t,r,n,i,a,s},null,null,null,Promise)},isAvailable:n,create:function(i,a){var s,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(d(a));case 2:return s=e.sent,e.t0=o,e.next=6,regeneratorRuntime.awrap(u.createConfirm(s));case 6:return e.t1=e.sent,c=e.t0.getResData.call(e.t0,e.t1),e.next=10,regeneratorRuntime.awrap(u.addChildDevice(i,c));case 10:return c.owner=i.owner,e.next=13,regeneratorRuntime.awrap(u.save(c));case 13:return e.abrupt("return",g.create((t=i,r=c,n=a.deviceType,{deviceId:t.id,description:'Added new child device to "'.concat(t.name,'" (ID: ').concat(t.id,")."),c8y_ProfibusDevice:{id:r.id,name:r.name,type:"/inventory/managedObjects/".concat(n.id)}})));case 14:case"end":return e.stop()}var t,r,n},null,null,null,Promise)}};function n(){return e.isFeatureFieldbus4Available()}function d(t){var r,n,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,n=t.deviceType,e.next=3,regeneratorRuntime.awrap(a.current());case 3:return i=e.sent,e.abrupt("return",{name:r,type:n.name,c8y_ProfibusDevice:{type:"/inventory/managedObjects/".concat(n.id)},owner:i.id});case 5:case"end":return e.stop()}},null,null,null,Promise)}}}angular.module("c8y.profibus").provider(a,e)}();