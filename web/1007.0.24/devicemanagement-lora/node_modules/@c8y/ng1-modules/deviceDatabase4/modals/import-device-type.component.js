"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,n):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}!function(){function e(e,a,c,n,r,t,i){var o=this,d={predefined:{info:null,deviceType:null},custom:{file:null,deviceType:null},newName:{value:null,edited:!1}};function l(e,n){d.predefined.info=e,d.predefined.deviceType=n}function u(){d.custom.file=null,d.custom.deviceType=null}function f(e,n){d.newName.edited||(d.newName.value=e),d.fieldbusType=n}function s(e){o.customDeviceTypeFeedback=e}_.assign(o,{$onInit:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=[],e.t1=_toConsumableArray(o.predefinedDeviceTypeInfos),e.t2=_toConsumableArray,e.next=5,regeneratorRuntime.awrap(c.getPredefinedDeviceTypeInfos());case 5:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),o.predefinedDeviceTypeInfos=e.t0.concat.call(e.t0,e.t1,e.t4),a.$apply();case 9:case"end":return e.stop()}},null,null,null,Promise)},selection:d,predefinedDeviceTypeInfos:[],downloadPredefinedDeviceType:function(e){return c.downloadPredefinedDeviceTypeAndSaveAs(e.id)},onPredefinedDeviceTypeInfoSelected:function(n){var r,t,i,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.id,t=n.name,i=n.fieldbusType,u(),e.next=4,regeneratorRuntime.awrap(c.getPredefinedDeviceType(r));case 4:o=e.sent,l(n,o),f(t,i),a.$apply();case 8:case"end":return e.stop()}},null,null,null,Promise)},isPredefinedDeviceTypeInfoSelected:function(e){return d.predefined.info===e},onCustomDeviceTypeFileSelected:function(e){if(!_.isEmpty(e)){var t=_.head(e);s({type:"progress",summary:i.getString("Processing file...")}),n.parseFile(t).then(function(e){var n=e.deviceType,r=e.feedback;d.predefined.info=null,d.predefined.deviceType=null,function(e,n){d.custom.file=e,d.custom.deviceType=n}(t,n),f(n.name,n.fieldbusType),s(r)}).catch(function(e){var n=e.feedback;u(),s(n)})}},onNewNameEdited:function(){d.newName.edited=!0},import:function(){var e=d.predefined,n=d.custom,r=d.newName,t=d.fieldbusType,i=_.cloneDeep(e.deviceType||n.deviceType);i.name=r.value,i.fieldbusType=t,o.close({$value:i})},downloadFileName:c.predefinedDeviceTypeHrefFilename,downloadFileHref:function e(n){var r=e.cache||{};e.cache=r;var t=r[n.id];t||(t=c.downloadPredefinedDeviceTypeHref(n).then(function(e){r[n.id]=e}),r[n.id]=t);return t.then?"":t}})}e.$inject=["$scope","$rootScope","c8yDeviceDatabase","c8yDeviceTypeParser","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.deviceDatabase4").component("c8yImportDeviceTypeModal",{templateUrl:":::PLUGIN_PATH:::/modals/import-device-type.html",bindings:{close:"&",dismiss:"&"},controllerAs:"vm",controller:e})}();