"use strict";!function(){function e(n,r,a,c,s,e,i,u){var o=s.url("devicecontrol/newDeviceRequests"),l=s.createEnum([{name:e.status.WAITING_FOR_CONNECTION,label:u("Waiting for connection")},{name:e.status.PENDING_ACCEPTANCE,label:u("Pending acceptance")},{name:e.status.ACCEPTED,label:u("Accepted")}]),d="c8y_BrokerSource",t="c8y_DataBroker",v={type:t};return{list:function(){var e={fragmentType:d};return a.list(e).then(S)},getUserDetails:p,updateUserStatus:function(e,t){return(t?c.enable(e):c.disable(e)).then(s.getResData)},listPending:function e(){var t=s.cleanListCallback("newDeviceRequests",e,{});return n.get(o).then(t).then(g)},acceptSubscription:function(e){var t=b(e);return n.put(t,{status:l.ACCEPTED.name},{headers:s.contentHeaders("newDeviceRequest")})},discardSubscription:function(e){var t=b(e);return n.delete(t)},registerNewSubscription:function(e){return n.post(o,{id:e,type:t},{headers:s.contentHeaders("newDeviceRequest")})},NEW_DEVICE_REQUEST_STATUS:l,removeSubscription:function(e){var t="_".concat(d);return _.set(e,d,null),a.save(_.pick(e,["id",d,t]))},getVisibleUserStatusText:f};function S(e){var t=_.map(e,function(t){return p(t.owner).then(function(e){return _.assign({},{userStatus:e.enabled,visibleUserStatus:f(e),userId:e.id,status:_.assign({},function(e){var t={};switch(e){case i.STATUS.ACTIVE.value:t={icon:"check",textClass:"text-success",text:u("Active")};break;case i.STATUS.SUSPENDED.value:t={icon:"exclamation-triangle",textClass:"text-warning",text:u("Inactive")};break;case i.STATUS.WAITING.value:t={icon:"spinner",iconClass:"fa-spin",textClass:"text-warning",text:u("Waiting")}}return _.assign(t,{value:e}),t}(t.c8y_BrokerSource.status)),id:t.id,_c8y_BrokerSource:t.c8y_BrokerSource})})});return r.all(t)}function p(e){return c.detail(e).then(s.getResData)}function f(e){return e.enabled?u("active`subscription`"):u("inactive`subscription`")}function g(e){return _(e).filter(v).map(function(e){return _.assign({},_.get(e,"customProperties.c8y_BrokerSource"),{status:l[e.status],type:e.type,id:e.id})}).value()}function b(e){return"".concat(o,"/").concat(encodeURIComponent(e))}}e.$inject=["$http","$q","c8yInventory","c8yUser","c8yBase","c8yDeviceRegistration","dataBrokerConnectorsSvc","gettext"],angular.module("c8y.dataBroker").factory("dataBrokerSubscriptionsSvc",e)}();