"use strict";function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),n.forEach(function(t){_defineProperty(e,t,o[t])})}return e}function _defineProperty(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}!function(){function t(c,i,l,o,n,r){var s="application/applications",u="application/vnd.com.nsn.cumulocity.applicationLogs+json;charset=UTF-8;ver=0.9";return{downloadAndSaveAs:function(t,o,n,a){return e(t,o,n,a).then(function(t){var e=t.logs;_.isEmpty(e)?r.info(d(n,a)):function(t,e){var o="".concat(t,".log"),n=new Blob([e],{type:"text/plain"});window.saveAs(n,o)}(o,e)})},shouldShowLogsTab:function(t){var e="c8y_Application_".concat(t);return o.list({type:e}).then(function(t){var e;if(_.isEqual(_.get(t,"length"),1)){var o=_.head(t),n=_.get(o,"c8y_SupportedLogs"),a=_.get(o,"c8y_Status.instances");e=_.some(n,function(t){return"syslog"===t})&&!_.isEmpty(a)}return e})},getAllLogs:e,getLogs:g,formatDateChosenByUser:function(t){var e=moment(t).format("YYYY-MM-DDTHH:mm:ss.SSS");return moment("".concat(e,"Z")).toISOString()},getWarningMessageForMissingLogs:d};function e(n,a,e,r){var i=[];return g(n,a,{dateFrom:e,dateTo:r}).then(function t(e){var o=m(e.dateTo);return i.push(e.logs),moment(o).isValid()&&e.truncated&&e.dateFrom!==e.dateTo?g(n,a,{dateFrom:o,dateTo:r}).then(t):c.resolve(i)}).then(function(t){return function(t,e,o){var n=o.join("");return{dateFrom:t,dateTo:e,logs:n}}(e,r,t)})}function g(t,e){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=3<arguments.length?arguments[3]:void 0,a=l.url("".concat(s,"/").concat(t,"/logs/").concat(e)),r=_objectSpread({headers:{Accept:u},params:o},n);return o.dateFrom&&(o.dateFrom=m(o.dateFrom)),o.dateTo&&(o.dateTo=m(o.dateTo)),i.get(a,r).then(l.getResData)}function m(t){return moment(t).format(l.dateFullFormatWithMs)}function d(t,e){var o;return!t&&e&&(o=n.getString("No logs available before {{dateTo | absoluteDateTimeFormat:'LL, LTS':'+0000'}}.",{dateTo:e})),t&&e&&(o=n.getString("No logs available in time range {{dateFrom | absoluteDateTimeFormat:'LL, LTS':'+0000'}} - {{dateTo | absoluteDateTimeFormat:'LL, LTS':'+0000'}}.",{dateFrom:t,dateTo:e})),t&&!e&&(o=n.getString("No logs available after {{dateFrom | absoluteDateTimeFormat:'LL, LTS':'+0000'}}.",{dateFrom:t})),t||e||(o=n.getString("No logs available.")),o}}t.$inject=["$q","$http","c8yBase","c8yInventory","gettextCatalog","c8yAlert"],angular.module("c8y.appLogs").factory("c8yApplicationLogs",t)}();