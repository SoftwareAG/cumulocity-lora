"use strict";!function(){function e(i,c,s,r,e,a,t){var o={},u=s.cleanFields,l="devicecontrol/newDeviceRequests",d={headers:s.contentHeaders("newDeviceRequest","newDeviceRequest")},C={WAITING_FOR_CONNECTION:"WAITING_FOR_CONNECTION",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",ACCEPTED:"ACCEPTED"},n=_.keys(C),f=[],v={},N=[],E=[];function g(e){var t=e.id||e;return s.url("".concat(l,"/").concat(encodeURIComponent(t)))}function p(e){var t=e.status||"UNKNOWN";return v[t.toUpperCase()]}function A(e){var t=e.id||e,n="device_".concat(t);E.push(n),function e(){var t=N.length,n="_deviceRegistration",c="/managedobjects/*",r=a.getStatus(n,c);!e.addedListener&&t&&(a.addListener(n,c,"CREATE",D),e.addedListener=!0),!r&&t&&a.start(n,c),r&&!t&&a.stop(n,c)}()}function D(e,t){if(function(e){return-1<E.indexOf(e.owner)}(t)){var n={managedObject:t};_.forEach(N,function(e){c.invoke(e,o,n)})}}return t("WAITING FOR CONNECTION"),t("PENDING ACCEPTANCE"),t("ACCEPTED"),v[C.WAITING_FOR_CONNECTION]={icon:"unlink",cls:"text-danger"},v[C.PENDING_ACCEPTANCE]={icon:"circle",cls:"text-info"},v[C.ACCEPTED]={icon:"check-circle",cls:"text-success"},window.jasmine&&_.assign(o,{_onMoCreate:D,_runHooks:A,_registrationHooks:N}),_.assign(o,{getLimitStatus:function(){var e=s.url("".concat(l,"/limit"));return i.get(e).then(s.getResData)},list:function e(t){var n=s.url(l),c=s.pageSizeFilter(t),r={params:c},a=s.cleanListCallback("newDeviceRequests",e,c);return i.get(n,r).then(a)},detail:function(e){var t=g(e);return i.get(t)},create:function(e,t){var n=s.url(l),c=u(e,f),r=_.assign({},d,t);if(!c.id)throw new Error("c8yDeviceRegistration: data must have an id property");return i.post(n,c,r)},bulkCreate:function(e,t){var n=_.assign({url:s.url("devicecontrol/bulkNewDeviceRequests"),method:"POST",headers:{Accept:"application/json"},file:e},t||{});return r.upload(n)},accept:function(e){A(e);var t=g(e),n={status:C.ACCEPTED},c=_.cloneDeep(d);return i.put(t,n,c)},acceptAll:function(){var e=s.url("".concat(l,"/acceptAll"));return i.post(e).then(s.getResData).then(function(e){var t=_.groupBy(e,"successful"),n=t.true||[],c=t.false||[];return _.forEach(n,function(e){return A(e)}),{acceptedDeviceRequests:n,failedDeviceRequests:c}})},cancel:function(e){var t=g(e);return i.delete(t)},status:C,statusList:n,getStyle:p,statusIcon:function(e){return p(e).icon},statusClass:function(e){return p(e).cls},addHook:function(t){return N.push(t),function(){var e=N.indexOf(t);-1<e&&N.splice(e,1)}},clearHooks:function(){N.length=0}}),e.enhanceWithKeysUtil({target:o,reservedKeys:[],standardKeys:{}})}e.$inject=["$http","$injector","c8yBase","$upload","c8yUtil","c8yRealtime","gettext"],angular.module("c8y.core").factory("c8yDeviceRegistration",e)}();