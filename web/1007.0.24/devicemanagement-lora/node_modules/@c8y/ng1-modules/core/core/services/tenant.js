"use strict";function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?Object(arguments[n]):{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.forEach(function(n){_defineProperty(e,n,t[n])})}return e}function _defineProperty(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}!function(){function n(o,u,l,n,r){var e,t="tenant/",s="".concat(t,"tenants"),a="".concat(t,"currentTenant"),c="management",i=1e3,p=["applications","ownedApplications","adminName"],f=["allowCreateTenants"],d=["adminPass"],v=l.cleanFields;return{list:function n(e){var t=l.pageSizeFilter(_objectSpread({},e,{pageSize:i,currentPage:_.get(e,"currentPage")}));var r={params:t};var a=l.url(s);var c=l.cleanListCallback("tenants",n,t);return o.get(a,r).then(c)},save:function(n){var e=_.cloneDeep(n),t=!e.applications,r=t?"post":"put",a=e.allowCreateTenants;e.adminPass||(e=v(e,d));e=v(e,t?f:p);var c=l.url(s)+(t?"":"/".concat(e.id)),i={headers:l.contentHeaders("tenant",!0)};return e=v(e,["id"]),u.resolve(e).then(function(n){return o[r](c,n,i)}).then(function(n){var e=u.resolve(n);return t&&a&&(e=e.then(function(n){return function(n,e,t,r){var a=n.data.id,c="".concat(e,"/").concat(a);return o.put(c,{allowCreateTenants:r},t)}(n,c,i,a)}).then(function(){return n})),e})},remove:function(n){var e=b(n);return o.delete(e)},detail:function(n){var e=b(n);return o.get(e)},addApplication:function(n,e,t){var r=e.id||e,a=m(n),c={application:{id:r,self:e.self}},i=_objectSpread({headers:l.contentHeaders("applicationReference",!0)},t);return o.post(a,c,i)},removeApplication:function(n,e,t){var r=e.id||e,a="".concat(m(n),"/").concat(r);return o.delete(a,t)},isCurrentUserTopTenant:function(){return n.current().then(function(n){return g(n.tenant)})},isParentTopTenant:function(n){return g(n.parent)},isTopTenant:g,current:function(){var n=0<arguments.length&&void 0!==arguments[0]&&arguments[0];e&&!n||(e=o.get(l.url(a),{silentError:!0}).then(l.getResData,function(n){return 404===n.status?u.when({allowsCreateSubtenant:!0}):u.reject(n)}));return e},isEnterpriseEditionTenant:function(){var e={name:"feature-branding"},t=[{name:"sslmanagement"},{name:"feature-user-hierarchy"},{name:"feature-broker"}];return r.areAllAvailable([{name:"branding"}].concat(t)).then(function(n){return n||r.areAllAvailable([e].concat(t))})},isSubscribed:function(e){return this.current().then(function(n){return _.get(n,"applications.references",[]).map(function(n){return n.application})}).then(function(n){return r.isAppOnTheList(n,e)})}};function b(n){var e=n.id||n;return l.url("".concat(s,"/").concat(e))}function m(n){return"".concat(b(n),"/applications")}function g(n){return n===c}}n.$inject=["$http","$q","c8yBase","c8yUser","c8yApplication"],angular.module("c8y.core").factory("c8yTenant",n)}();