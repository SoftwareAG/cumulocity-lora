"use strict";!function(){function e(r,t,u,c,s,a,n,l,i,d,h,v,f,g,o,p){return{addAssetUI:function(){return o.open({component:"c8yGroupCreateAndAssignModal"}).result},editGroup:function(e){t.url("/group/".concat(e.id))},deleteGroup:function(e){return a.remove(e)},deleteGroupWithConfirmation:function(t){var n=0<_.get(t,"childAssets.references.length")||0<_.get(t,"childDevices.references.length"),e=i.isDynamicGroup(t),r=function(){return n||e?g.getString('You are about to delete group "{{name}}". This operation is irreversible. Do you want to proceed?',t):g.getString('You are about to delete group "{{name}}" and its sub-groups recursively. This operation is irreversible. Do you want to proceed?',t)},o=e&&!n?u.when():d.getItemsCount(t).then(function(e){n=0===e});return o.then(function(){return c({title:f("Delete group"),body:r(),checkboxes:{cascade:{text:f("Also delete all devices inside this group and its sub-groups."),checked:!1,showIf:function(){return!(n||e)}}},status:"danger",labels:{ok:f("Delete")}}).then(function(e){return i.isSmartGroupV2(t)?i.remove(t):a.remove(t,e)}).then(function(){return v.removeGroupNavigation(t)}).then(function(){return s.success(f("Group deleted."))})})},deleteDeviceWithConfirmation:function(n,e){var t=void 0===n.c8y_IsDevice,r=!_.isUndefined(n.childDevices)&&0<n.childDevices.references.length,o=function(){return!t&&!e&&r},i=function(){return{title:f("Delete device"),body:g.getString('You are about to delete device "{{name}}". This operation is irreversible. Do you want to proceed?',n),checkboxes:{cascade:{text:f("Also delete child devices of this device."),checked:o(),showIf:o},withDeviceUser:{text:g.getString('Also delete associated device owner "{{owner}}".',n),checked:!1,showIf:function(){var e=n.c8y_IsDevice,t=n.owner&&l.isDeviceUser({id:n.owner});return Boolean(e&&t)}}},labels:{ok:f("Delete")},status:"danger"}};return(r||e||t?u.when():h.getChildDevicesCount(n).then(function(e){r=0<e})).then(function(){return c(i()).then(function(e){return a.remove(n,e)}).then(function(){return v.updateAllGroupsOfAChild(n)}).then(function(){return s.success(f("Device deleted."))})})},unassignDevice:function(t,n){var e={title:f("Unassign device"),body:g.getString('You are about to unassign device "{{name}}". Do you want to proceed?',n),status:"warning",size:"sm",labels:{ok:f("Unassign")}};return c(e).then(function(){return p.isApplicationAvailable().then(function(e){return e?function(e,t){var n=u.when();try{return(n=r.get("smartRulesSvc")).listByContext(e).then(function(e){return u.all(e.map(function(e){return n.deactivate(e,t,!1)}))})}catch(e){return n}}(t.id,n):null})}).then(function(){return a.removeChildAsset(t,n)}).then(function(){return v.updateGroupChildren(t)})},assignDevices:function(e){return o.open({component:"c8yGroupDeviceAssignmentModal",resolve:{currentGroup:function(){return e}}}).result.then(function(){return v.updateGroupChildren(e)})},getGroup:function(e){return a.detail(e).then(n.getResData)}}}e.$inject=["$injector","$location","$q","c8yModal","c8yAlert","c8yInventory","c8yBase","c8yUser","c8yDynamicGroups","c8yGroups","c8yDevices","groupTypesHierarchyNavigator","gettext","gettextCatalog","$uibModal","c8ySmartRulesAvailability"],angular.module("c8y.ui").factory("groupsHierarchySvc",e)}();