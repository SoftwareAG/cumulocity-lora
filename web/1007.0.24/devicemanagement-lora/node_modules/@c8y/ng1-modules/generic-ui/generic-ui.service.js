"use strict";!function(){function e(o,r,i,e,u,s,a,c){var n,f="".concat("c8y_JsonSchema",".fragmentType"),l={};return{hasMatchingSchemas:function(t){return(n||p()).then(function(e){return _.some(e,function(e){return g(t,e).length})})},getMatchingSchemas:function(t){return(n||p()).then(function(e){return _.some(e,function(e){return g(t,e)})})},matchObjectWithSchemas:function(n,e){return _.reduce(e,function(e,t){return e.concat(g(n,t))},[])},listSchemas:p,replaceObjectPlaceholders:function(e,t,n){var r=_.assign({managedObject:t,object:_.get(t,n)});return d(e,r)},replaceOperationTemplatePlaceholders:function(e,t,n,r){return d(e,_.assign({managedObject:t,object:_.get(t,n.path),property:n.key},r))},getProperties:function(e,t,n,r){var i=_.get(t,n),a=_.get(e,"id"),c=_.keys(i),o=u.getProperties(e);r||(o=_.filter(o,function(e){var t=e.key;return _.includes(c,t)}));return _.map(o,function(e){return _.assign({operationList:[],schemaId:a,path:n},e)})},listPendingOperations:function(t){var e=s.status,n=e.PENDING,r=e.EXECUTING,i=[n,r];if(!l[t]){var a=i.map(function(e){return{deviceId:t,status:e,pageSize:1e3}}).map(s.list);l[t]=o.all(a).then(_.flatten);var c=l[t];c.finally(function(){return _.unset(l,t)})}return l[t]},createOperation:function(e,t,n,r){var i=function(e,t,n,r){var i=_.pick(n,["schemaId","path","key"]);return i.operation=t,_.assign({c8y_JsonSchemaContext:i,deviceId:r.id,deviceName:r.name,description:t},e)}(e,t,n,r);return s.createWithNotifications(i)},sortProperties:function(e){return _.sortBy(e,[function(e){return-(e.priority||0)},function(e){return _.lowerCase(c.getString(e.title)||e.key)}])},alertOperationCreateSuccess:function(e){var t=a('"{{description | translate}}" will be executed.');e.then(function(e){return i.success(c.getString(t,e))})},alertOperationComplete:function(e){var t=a('"{{description | translate}}" completed.'),n=a('"{{description | translate}}" failed.'),r=a('"{{description | translate}}" failed due to: "{{failureReason | translate}}".');e.then(function(e){e.status===s.status.SUCCESSFUL?i.success(c.getString(t,e)):e.failureReason?i.danger(c.getString(r,e),e):i.danger(c.getString(n,e))})},showSave:function(e){return _.some(e,function(e){return!function(e){return _.keys(e).map(function(e){return e.toLowerCase()}).includes("readonly")}(e)&&"operations"!==e.type})}};function p(){return n=u.list().then(function(e){return _.filter(e,"appliesTo.GENERIC_UI")})}function g(e,t){var n=_.keys(e),r=_.get(t,f),i=[];if(void 0!==r){var a=new RegExp(r);i=n.filter(function(e){return a.test(e)}).map(function(e){return{key:e,schema:t}})}return i}function d(e,t){var n=e.replace(/\${([^}]+)}/g,"{{$1}}");return r(n)(t)}}e.$inject=["$q","$interpolate","c8yAlert","c8yInventory","c8yJsonSchemas","c8yDeviceControl","gettext","gettextCatalog"],angular.module("c8y.genericUi").factory("c8yGenericUi",e)}();