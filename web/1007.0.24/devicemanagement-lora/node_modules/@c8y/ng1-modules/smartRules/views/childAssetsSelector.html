<div class="c8y-child-assets-selector"
  is-open="ctrl.dropdownStatus.open"
  uib-dropdown>
  <button type="button"
    class="btn dropdown-toggle c8y-dropdown"
    title="{{ctrl.getSelectedText()}}"
    uib-dropdown-toggle>
    <span class="text-truncate">
      <i c8y-icon="check" ng-class="{'text-success': ctrl.areAllOriginallySelected()}"></i>
      <span ng-bind="ctrl.getSelectedStatusText()"></span>
    </span>
  </button>
  <ul class="dropdown-menu multiselect-container"
    ng-click="$event.stopPropagation();"
    uib-dropdown-menu>
    <li class="multiselect-item">
      <div class="input-group input-group-search">
        <input class="form-control"
          type="search"
          placeholder="{{'Type to filter' | translate}}&hellip;"
          ng-model="ctrl.filterCfg.text">
        <span class="input-group-addon">
                <i c8y-icon="search" ng-class="{'fa-spin': loading}" class="fa fw fa-search"></i>
            </span>
      </div>

    </li>
    <li class="multiselect-item">
      <label 
        title="{{ 'Check all visible' | translate }}"
        ng-if="!ctrl.areAllVisibleSelected()"
        class="c8y-checkbox input-sm"
        ng-click="ctrl.selectAllVisible()">
        <input
          type="checkbox"
          ng-checked="false"
          ng-click="ctrl.selectAllVisible(); $event.stopPropagation();"
          style="margin-top:0;"
        ><span></span>
        <span translate>Check all visible</span>
      </label>
      <label 
        title="{{ 'Uncheck all visible' | translate }}"
        ng-if="ctrl.areAllVisibleSelected()"
        class="c8y-checkbox input-sm"
        ng-click="ctrl.deselectAllVisible()">
        <input
          type="checkbox"
          ng-checked="true"
          ng-click="ctrl.deselectAllVisible(); $event.stopPropagation();"
          style="margin-top:0;"
        ><span></span>
        <span translate>Uncheck all visible</span>
      </label>
    </li>
    <li class="divider"></li>
    <li class="multiselect-item-container">
      <div ng-if="!(ctrl.dropdownStatus.open && ctrl.dropdownOpeningFinished)"
        class="text-center"
        style="padding: 8px;">
        <i c8y-icon="circle-o-notch"
          class="fa-spin"></i>
        <translate>Loading</translate>&hellip;
      </div>
      <ul class="list-unstyled"
        ng-if="ctrl.dropdownStatus.open && ctrl.dropdownOpeningFinished">
        <li ng-repeat="childAsset in ctrl.childAssets | filter:ctrl.filterCfg.text"
          class="multiselect-item">
          <label class="c8y-checkbox input-sm text-truncate"
            ng-click="ctrl.toggle(childAsset); $event.preventDefault()">
            <input
              type="checkbox"
              ng-checked="ctrl.isSelected(childAsset)"
              ng-click="ctrl.toggle(childAsset); $event.stopPropagation()"
              style="margin-top:0;"
            ><span></span>
            <span class="label-text" title="{{childAsset.name}}" ng-bind="childAsset.name"></span>
          </label>
        </li>
      </ul>
    </li>
    <li class="divider"></li>
    <li><button 
        title="{{ 'Apply' | translate }}"
        class="btn btn-primary btn-block"
        ng-click="ctrl.apply()"
        translate>Apply</button></li>
  </ul>
</div>