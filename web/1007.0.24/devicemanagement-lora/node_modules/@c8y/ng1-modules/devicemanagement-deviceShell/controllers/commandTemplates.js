"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}!function(){function e(e,n,t,r,a,l,o,i,m){var c,d,y=this,s=[],u=a.getDeliveryTypes().defaultDeliveryType,p=a.getDeliveryTypes().standardDeliveryTypes;function T(e){s.length=0,_.forEach(e,function(e){var t=!!e.id;s.push({name:t?e.name:m.getString(e.name),command:e.command,category:t?e.category:m.getString(e.category),deliveryTypes:e.deliveryTypes,id:e.id})})}function f(e){y.result.commandTemplate=e,_.difference(e.deliveryTypes,p)||y.standardDeliveryTypes.push(e.deliveryType),y.commandDeliveryType=_.first(e.deliveryTypes)||u}_.assign(y,{commandTemplates:s,standardDeliveryTypes:p,defaultDeliveryType:u,commandDeliveryTypesSelected:{},validateSelectedDeliveryTypes:function(){return _.isEmpty(_.pickBy(y.commandDeliveryTypesSelected))},result:{action:null,commandTemplate:null},forms:{},onTemplateSelected:f,use:function(e){y.result.action="USE",y.result.deliveryType=e!==u&&e,y.result.commandTemplate=_.clone(y.result.commandTemplate);var t=y.result.commandTemplate;t.text=t.text||t.command,n.close(y.result)},execute:function(e){y.result.action="EXECUTE",y.result.deliveryType=e!==u&&e,y.result.commandTemplate=_.clone(y.result.commandTemplate);var t=y.result.commandTemplate;t.text=t.command,n.close(y.result)},cancel:function(){y.newCommandTemplate?delete y.newCommandTemplate:n.dismiss()},save:function(){y.newCommandTemplate.deliveryTypes=_.keys(_.pickBy(y.commandDeliveryTypesSelected)),a.saveTemplate(y.newCommandTemplate).then(t.getResData).then(function(e){var t=_.pick(e,["id","name","category","command","text","deliveryTypes"]),n=_.find(s,{id:t.id});n?_.assign(n,t):s.unshift(t),f(y.result.commandTemplate=t),delete y.newCommandTemplate})},addNew:function(){y.newCommandTemplate={deviceType:c},y.commandDeliveryTypesSelected=_defineProperty({},u,!0)},hideAddButton:function(){return!!y.newCommandTemplate},edit:function(e){var t;t=_.isEmpty(e.deliveryTypes)?p:e.deliveryTypes;_.forEach(t,function(e){_.assign(y.commandDeliveryTypesSelected,_defineProperty({},e,!0))}),y.newCommandTemplate=e},remove:function(e){y.result.commandTemplate===e&&delete y.result.commandTemplate;a.removeTemplate(e).then(function(){_.pull(s,e)}).then(function(){o.success(i("Shell command template deleted."))})},isDeliveryTypeSupported:function(e,t){var n=_.get(t,"deliveryTypes");return _.isEmpty(n)||_.includes(n,e)},getExecuteButtonLabel:function(e){return e!==u?m.getString("Execute (via {{ deliveryType | translate }})",{deliveryType:e}):m.getString("Execute")},appendToEl:document.getElementsByClassName("modal")}),(d=e.deviceId,r.detailCached(d).then(t.getResData).then(function(e){return c=_.concat(e.type,e.c8y_DeviceTypes||[]),a.getCommandTemplatesForDeviceType.apply(a,_toConsumableArray(c))})).then(T),a.canSendCommandsViaSMS().then(function(e){y.smsEnabled=e}),l.hasAnyRole(["ROLE_INVENTORY_ADMIN"]).then(function(e){y.canWrite=e})}e.$inject=["$routeParams","$uibModalInstance","c8yBase","c8yDevices","c8yDeviceShell","c8yPermissions","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.deviceShell").controller("commandTemplatesCtrl",e)}();