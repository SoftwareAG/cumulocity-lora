"use strict";!function(){function t(e,c,t){var r=t.getD3Locales().timeFormat.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%H:%M",function(t){return t.getMinutes()}],["%H:%M",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!==t.getDate()}],["%b %d",function(t){return 1!==t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",function(){return!0}]]);function n(t){(this.chart=t).addItem(this)}return n.prototype={scale:function(){var t=this,e=t.chart.box();return d3.time.scale().domain([t._from,t._to]).range([e.rangeMin,e.rangeMax])},axis:function(){return d3.svg.axis().scale(this.scale()).orient("bottom").ticks(6).tickFormat(r)},canRender:function(){return!(!this._from||!this._to)},updateDates:function(t,e,r){var n=this;n._from=moment(t).toDate(),n._to=moment(e).toDate(),r&&n.onUpdateDates&&n.onUpdateDates(n._from,n._to),n._xDragStart&&n.chart.render()},getDebouncePreference:function(){var t=this,e=moment(t._to).diff(moment(t._from),"seconds");return t.debounceTime!==e?{debounceTime:(t.debounceTime=e)||200,reset:!0}:{debounceTime:e||200,reset:!1}},render:function(){var t=this,e=t.axis(),r=t.el,n=t.chart.box(),a=t.chart.margins,o=n.height-a.b;if(!r){var s=t.chart.svg;t.el=s.append("g").attr({class:"xaxis axis",transform:c.translate(a.l,o)}).style({"pointer-events":"all",cursor:"ew-resize"}),(r=t.el).boxHover=r.append("rect").attr({class:"recthover",height:19,fill:"rgba(255,255,255,0.01)",transform:c.translate(a.l,0)}),t.drag=d3.behavior.drag();var i=t.drag;r.call(i),r.boxHover.call(i),t.addEvents()}r.boxHover.attr("width",function(){return t.chart.box().axisXwidth}),t.canRender()&&r.call(e).attr({transform:c.translate(a.l,o)})},onMouseDown:function(){var e=this;return function(){d3.event.sourceEvent.stopPropagation(),e._scale=e.scale();var t=e._scale;e._xDragStart=t.invert(d3.mouse(e.el.node())[0]),e.__from=e._from,e.__to=e._to,e.el.select("path").style("stroke","#CCC")}},onDragEnd:function(){var t=this;return function(){d3.event.sourceEvent.stopPropagation(),_.isUndefined(t._xDragStart)||(t.chart.render(),t.el.select("path").style("stroke",""),t.onUpdateDates&&(t.onUpdateDates(t._from,t._to),e.$apply())),delete t._xDragStart}},updateScaleOnDrag:function(t){var e=this,r=e._scale,n=moment(r.invert(t)).diff(e._xDragStart);e.updateDates(moment(e.__from).subtract(n,"ms"),moment(e.__to).subtract(n,"ms")),e.render()},onDrag:function(){var e=this;return function(){d3.event.sourceEvent.stopPropagation();var t=e.el.node();_.isUndefined(e._xDragStart)||e.updateScaleOnDrag(d3.mouse(t)[0])}},addEvents:function(){this.drag.on("dragstart",this.onMouseDown()).on("drag",this.onDrag()).on("dragend",this.onDragEnd())}},n}t.$inject=["$rootScope","c8yChartCommon","c8yLocales"],angular.module("c8y.core.measurements2").factory("c8yAxisX",t)}();