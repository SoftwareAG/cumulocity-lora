import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { set, unset, toInteger } from 'lodash';
import { gettext } from '@c8y/ngx-components';
import { ControlContainer, NgModelGroup } from '@angular/forms';
let OpcuaDeviceProtocolDataReportingComponent = class OpcuaDeviceProtocolDataReportingComponent {
    constructor() {
        this.onSubscriptionChange = new EventEmitter();
        this.subscription = {
            type: 'None'
        };
        this.subscriptionParameters = {
            samplingRate: undefined,
            deadbandType: 'None',
            deadbandValue: undefined,
            ranges: '',
            queueSize: undefined,
            dataChangeTrigger: 'Status',
            discardOldest: true
        };
        this.cyclicReadParameters = {
            rate: undefined
        };
        this.types = [
            { value: 'None', label: gettext('None') },
            { value: 'CyclicRead', label: gettext('Cyclic read') },
            { value: 'Subscription', label: gettext('Subscription') }
        ];
        this.filters = [
            { value: 'None', label: gettext('None') },
            { value: 'absolute', label: gettext('Absolute') },
            { value: 'percent', label: gettext('Percent') }
        ];
        this.triggers = [
            { value: 'Status', label: gettext('Status') },
            { value: 'StatusValue', label: gettext('Status/Value') },
            { value: 'StatusValueTimestamp', label: gettext('Status/Value/Timestamp') }
        ];
        this.discard = [
            { value: true, label: gettext('oldest`data`') },
            { value: false, label: gettext('newest`data`') }
        ];
        this.requireCyclic = false;
        this.requireSubscription = false;
        this.parseReadingInterval = $event => toInteger($event.target.value);
    }
    set model(_model) {
        if (_model.subscriptionType) {
            this.subscription = _model.subscriptionType;
            if (this.subscription.type === 'CyclicRead') {
                this.cyclicReadParameters = _model.subscriptionType.cyclicReadParameters;
                this.requireCyclic = true;
                this.requireSubscription = false;
            }
            if (this.subscription.type === 'Subscription') {
                this.subscriptionParameters = _model.subscriptionType.subscriptionParameters;
                this.requireCyclic = false;
                this.requireSubscription = true;
            }
            if (this.subscription.type === 'None') {
                this.requireCyclic = false;
                this.requireSubscription = false;
            }
        }
        this._model = _model;
    }
    updateModel() {
        setTimeout(() => {
            unset(this.subscription, 'subscriptionParameters');
            unset(this.subscription, 'cyclicReadParameters');
            if (this.subscription.type === 'CyclicRead') {
                this.requireCyclic = true;
                this.requireSubscription = false;
                set(this.subscription, 'cyclicReadParameters', this.cyclicReadParameters);
            }
            else if (this.subscription.type === 'Subscription') {
                this.requireCyclic = false;
                this.requireSubscription = true;
                set(this.subscription, 'subscriptionParameters', this.subscriptionParameters);
            }
            else if (this.subscription.type === 'None') {
                this.requireCyclic = false;
                this.requireSubscription = false;
            }
        });
    }
};
tslib_1.__decorate([
    Input()
], OpcuaDeviceProtocolDataReportingComponent.prototype, "model", null);
tslib_1.__decorate([
    Input()
], OpcuaDeviceProtocolDataReportingComponent.prototype, "groupName", void 0);
tslib_1.__decorate([
    Output()
], OpcuaDeviceProtocolDataReportingComponent.prototype, "onSubscriptionChange", void 0);
OpcuaDeviceProtocolDataReportingComponent = tslib_1.__decorate([
    Component({
        selector: 'opcua-device-protocol-data-reporting',
        template: "<c8y-form-group>\n  <label translate>Mechanism</label>\n  <label\n    *ngFor=\"let mechanism of types\"\n    title=\"{{ mechanism.label | translate }}\"\n    class=\"c8y-radio radio-inline\"\n  >\n    <input\n      type=\"radio\"\n      name=\"subscriptionType\"\n      [value]=\"mechanism.value\"\n      [(ngModel)]=\"subscription.type\"\n      (change)=\"updateModel()\"\n      required\n    />\n    <span></span> {{ mechanism.label | translate }}\n  </label>\n</c8y-form-group>\n\n<div class=\"row collapse\" [collapse]=\"subscription.type != 'CyclicRead'\" [isAnimated]=\"true\">\n  <div class=\"col-sm-6 col-md-4 col-lg-3\">\n    <c8y-form-group>\n      <label translate>Reading interval</label>\n      <div class=\"input-group\">\n        <input\n          class=\"form-control\"\n          type=\"number\"\n          name=\"rate\"\n          [(ngModel)]=\"cyclicReadParameters.rate\"\n          placeholder=\"{{ 'e.g.' | translate }} 50\"\n          [required]=\"requireCyclic\"\n          min=\"0\"\n        />\n        <span class=\"input-group-addon units\" title=\"{{ 'Milliseconds' | translate }}\" translate>\n          msec\n        </span>\n      </div>\n    </c8y-form-group>\n  </div>\n</div>\n\n<div class=\"row collapse\" [collapse]=\"subscription.type != 'Subscription'\" [isAnimated]=\"true\">\n  <div class=\"col-sm-6 col-lg-4\">\n    <c8y-form-group>\n      <label translate>Sampling interval</label>\n      <div class=\"input-group\">\n        <input\n          class=\"form-control\"\n          type=\"number\"\n          name=\"samplingRate\"\n          [(ngModel)]=\"subscriptionParameters.samplingRate\"\n          placeholder=\"{{ 'e.g.' | translate }} 500\"\n          [required]=\"requireSubscription\"\n          min=\"0\"\n        />\n        <span class=\"input-group-addon units\" title=\"{{ 'Milliseconds' | translate }}\" translate>\n          msec\n        </span>\n      </div>\n    </c8y-form-group>\n  </div>\n  <div class=\"col-sm-6 col-lg-4\">\n    <c8y-form-group>\n      <label translate>Queue size</label>\n      <div class=\"input-group\">\n        <input\n          class=\"form-control\"\n          type=\"number\"\n          name=\"queueSize\"\n          [(ngModel)]=\"subscriptionParameters.queueSize\"\n          placeholder=\"{{ 'e.g.' | translate }} 10\"\n          min=\"1\"\n        />\n        <span class=\"input-group-addon\">\n          <strong translate>Discard</strong>&nbsp;\n          <label\n            *ngFor=\"let discardOption of discard\"\n            title=\"{{ discardOption.label | translate }}\"\n            class=\"c8y-radio radio-inline\"\n          >\n            <input\n              type=\"radio\"\n              name=\"discard\"\n              [value]=\"discardOption.value\"\n              [(ngModel)]=\"subscriptionParameters.discardOldest\"\n              [required]=\"requireSubscription\"\n            />\n            <span></span> {{ discardOption.label | translate }}\n          </label>\n        </span>\n      </div>\n    </c8y-form-group>\n  </div>\n  <div class=\"clearfix\"></div>\n  <div class=\"col-sm-6 col-lg-4\">\n    <c8y-form-group>\n      <label translate>Data change trigger</label>\n      <label\n        *ngFor=\"let trigger of triggers\"\n        title=\"{{ trigger.label | translate }}\"\n        class=\"c8y-radio radio-inline\"\n      >\n        <input\n          type=\"radio\"\n          name=\"dataChangeTrigger\"\n          [value]=\"trigger.value\"\n          [(ngModel)]=\"subscriptionParameters.dataChangeTrigger\"\n          [required]=\"requireSubscription\"\n        />\n        <span></span> {{ trigger.label | translate }}\n      </label>\n    </c8y-form-group>\n  </div>\n  <div class=\"col-sm-6 col-lg-4\">\n    <c8y-form-group>\n      <label translate>Deadband filter</label>\n      <label\n        *ngFor=\"let deadbandFilter of filters\"\n        title=\"{{ deadbandFilter.label | translate }}\"\n        class=\"c8y-radio radio-inline\"\n      >\n        <input\n          type=\"radio\"\n          name=\"deadbandType\"\n          [value]=\"deadbandFilter.value\"\n          [(ngModel)]=\"subscriptionParameters.deadbandType\"\n          [required]=\"requireSubscription\"\n        />\n        <span></span> {{ deadbandFilter.label | translate }}\n      </label>\n    </c8y-form-group>\n    <div [collapse]=\"subscriptionParameters.deadbandType == 'None'\" [isAnimated]=\"true\">\n      <c8y-form-group>\n        <label translate>Deadband value</label>\n        <input\n          class=\"form-control\"\n          type=\"number\"\n          name=\"deadbandValue\"\n          [(ngModel)]=\"subscriptionParameters.deadbandValue\"\n          placeholder=\"{{ 'e.g.' | translate }} 10\"\n          [required]=\"subscriptionParameters.deadbandType != 'None'\"\n          min=\"0\"\n        />\n      </c8y-form-group>\n    </div>\n  </div>\n</div>\n",
        viewProviders: [{ provide: ControlContainer, useExisting: NgModelGroup }]
    })
], OpcuaDeviceProtocolDataReportingComponent);
export { OpcuaDeviceProtocolDataReportingComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtZGV2aWNlLXByb3RvY29sLWRhdGEtcmVwb3J0aW5nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvcHJvdG9jb2wtb3BjdWEvIiwic291cmNlcyI6WyJvcGN1YS1kZXZpY2UtcHJvdG9jb2wtZGF0YS1yZXBvcnRpbmcuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUMvQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDOUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBT2hFLElBQWEseUNBQXlDLEdBQXRELE1BQWEseUNBQXlDO0lBTHREO1FBK0JZLHlCQUFvQixHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBRTVFLGlCQUFZLEdBQUc7WUFDYixJQUFJLEVBQUUsTUFBTTtTQUNiLENBQUM7UUFDRiwyQkFBc0IsR0FBRztZQUN2QixZQUFZLEVBQUUsU0FBUztZQUN2QixZQUFZLEVBQUUsTUFBTTtZQUNwQixhQUFhLEVBQUUsU0FBUztZQUN4QixNQUFNLEVBQUUsRUFBRTtZQUNWLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLGlCQUFpQixFQUFFLFFBQVE7WUFDM0IsYUFBYSxFQUFFLElBQUk7U0FDcEIsQ0FBQztRQUVGLHlCQUFvQixHQUFHO1lBQ3JCLElBQUksRUFBRSxTQUFTO1NBQ2hCLENBQUM7UUFFRixVQUFLLEdBQVU7WUFDYixFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUN6QyxFQUFFLEtBQUssRUFBRSxZ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Q0FBQyxtQkFBbUIsR0FBRyxLQUFLLENBQUM7Z0JBQ2pDLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLHNCQUFzQixFQUFFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO2FBQzNFO2lCQUFNLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEtBQUssY0FBYyxFQUFFO2dCQUNwRCxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztnQkFDM0IsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQztnQkFDaEMsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsd0JBQXdCLEVBQUUsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7YUFDL0U7aUJBQU0sSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksS0FBSyxNQUFNLEVBQUU7Z0JBQzVDLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO2dCQUMzQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxDQUFDO2FBQ2xDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YsQ0FBQTtBQTFGVTtJQUFSLEtBQUssRUFBRTtzRUFxQlA7QUFDUTtJQUFSLEtBQUssRUFBRTs0RUFBVztBQUdUO0lBQVQsTUFBTSxFQUFFO3VGQUFtRTtBQTFCakUseUNBQXlDO0lBTHJELFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxzQ0FBc0M7UUFDaEQsb3hKQUEwRDtRQUMxRCxhQUFhLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLENBQUM7S0FDMUUsQ0FBQztHQUNXLHlDQUF5QyxDQTJGckQ7U0EzRlkseUNBQXlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHNldCwgdW5zZXQsIHRvSW50ZWdlciB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBnZXR0ZXh0IH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5pbXBvcnQgeyBDb250cm9sQ29udGFpbmVyLCBOZ01vZGVsR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ29wY3VhLWRldmljZS1wcm90b2NvbC1kYXRhLXJlcG9ydGluZycsXG4gIHRlbXBsYXRlVXJsOiAnLi9vcGN1YS1kZXZpY2UtcHJvdG9jb2wtZGF0YS1yZXBvcnRpbmcuaHRtbCcsXG4gIHZpZXdQcm92aWRlcnM6IFt7IHByb3ZpZGU6IENvbnRyb2xDb250YWluZXIsIHVzZUV4aXN0aW5nOiBOZ01vZGVsR3JvdXAgfV1cbn0pXG5leHBvcnQgY2xhc3MgT3BjdWFEZXZpY2VQcm90b2NvbERhdGFSZXBvcnRpbmdDb21wb25lbnQge1xuICBASW5wdXQoKSBzZXQgbW9kZWwoX21vZGVsKSB7XG4gICAgaWYgKF9tb2RlbC5zdWJzY3JpcHRpb25UeXBlKSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IF9tb2RlbC5zdWJzY3JpcHRpb25UeXBlO1xuICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uLnR5cGUgPT09ICdDeWNsaWNSZWFkJykge1xuICAgICAgICB0aGlzLmN5Y2xpY1JlYWRQYXJhbWV0ZXJzID0gX21vZGVsLnN1YnNjcmlwdGlvblR5cGUuY3ljbGljUmVhZFBhcmFtZXRlcnM7XG4gICAgICAgIHRoaXMucmVxdWlyZUN5Y2xpYyA9IHRydWU7XG4gICAgICAgIHRoaXMucmVxdWlyZVN1YnNjcmlwdGlvbiA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb24udHlwZSA9PT0gJ1N1YnNjcmlwdGlvbicpIHtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25QYXJhbWV0ZXJzID0gX21vZGVsLnN1YnNjcmlwdGlvblR5cGUuc3Vic2NyaXB0aW9uUGFyYW1ldGVycztcbiAgICAgICAgdGhpcy5yZXF1aXJlQ3ljbGljID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVxdWlyZVN1YnNjcmlwdGlvbiA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbi50eXBlID09PSAnTm9uZScpIHtcbiAgICAgICAgdGhpcy5yZXF1aXJlQ3ljbGljID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVxdWlyZVN1YnNjcmlwdGlvbiA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLl9tb2RlbCA9IF9tb2RlbDtcbiAgfVxuICBASW5wdXQoKSBncm91cE5hbWU7XG5cbiAgX21vZGVsOiBvYmplY3Q7XG4gIEBPdXRwdXQoKSBvblN1YnNjcmlwdGlvbkNoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBzdWJzY3JpcHRpb24gPSB7XG4gICAgdHlwZTogJ05vbmUnXG4gIH07XG4gIHN1YnNjcmlwdGlvblBhcmFtZXRlcnMgPSB7XG4gICAgc2FtcGxpbmdSYXRlOiB1bmRlZmluZWQsXG4gICAgZGVhZGJhbmRUeXBlOiAnTm9uZScsXG4gICAgZGVhZGJhbmRWYWx1ZTogdW5kZWZpbmVkLFxuICAgIHJhbmdlczogJycsXG4gICAgcXVldWVTaXplOiB1bmRlZmluZWQsXG4gICAgZGF0YUNoYW5nZVRyaWdnZXI6ICdTdGF0dXMnLFxuICAgIGRpc2NhcmRPbGRlc3Q6IHRydWVcbiAgfTtcblxuICBjeWNsaWNSZWFkUGFyYW1ldGVycyA9IHtcbiAgICByYXRlOiB1bmRlZmluZWRcbiAgfTtcblxuICB0eXBlczogYW55W10gPSBbXG4gICAgeyB2YWx1ZTogJ05vbmUnLCBsYWJlbDogZ2V0dGV4dCgnTm9uZScpIH0sXG4gICAgeyB2YWx1ZTogJ0N5Y2xpY1JlYWQnLCBsYWJlbDogZ2V0dGV4dCgnQ3ljbGljIHJlYWQnKSB9LFxuICAgIHsgdmFsdWU6ICdTdWJzY3JpcHRpb24nLCBsYWJlbDogZ2V0dGV4dCgnU3Vic2NyaXB0aW9uJykgfVxuICBdO1xuXG4gIGZpbHRlcnM6IGFueVtdID0gW1xuICAgIHsgdmFsdWU6ICdOb25lJywgbGFiZWw6IGdldHRleHQoJ05vbmUnKSB9LFxuICAgIHsgdmFsdWU6ICdhYnNvbHV0ZScsIGxhYmVsOiBnZXR0ZXh0KCdBYnNvbHV0ZScpIH0sXG4gICAgeyB2YWx1ZTogJ3BlcmNlbnQnLCBsYWJlbDogZ2V0dGV4dCgnUGVyY2VudCcpIH1cbiAgXTtcblxuICB0cmlnZ2VyczogYW55W10gPSBbXG4gICAgeyB2YWx1ZTogJ1N0YXR1cycsIGxhYmVsOiBnZXR0ZXh0KCdTdGF0dXMnKSB9LFxuICAgIHsgdmFsdWU6ICdTdGF0dXNWYWx1ZScsIGxhYmVsOiBnZXR0ZXh0KCdTdGF0dXMvVmFsdWUnKSB9LFxuICAgIHsgdmFsdWU6ICdTdGF0dXNWYWx1ZVRpbWVzdGFtcCcsIGxhYmVsOiBnZXR0ZXh0KCdTdGF0dXMvVmFsdWUvVGltZXN0YW1wJykgfVxuICBdO1xuXG4gIGRpc2NhcmQ6IGFueVtdID0gW1xuICAgIHsgdmFsdWU6IHRydWUsIGxhYmVsOiBnZXR0ZXh0KCdvbGRlc3RgZGF0YWAnKSB9LFxuICAgIHsgdmFsdWU6IGZhbHNlLCBsYWJlbDogZ2V0dGV4dCgnbmV3ZXN0YGRhdGFgJykgfVxuICBdO1xuXG4gIHJlcXVpcmVDeWNsaWM6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcmVxdWlyZVN1YnNjcmlwdGlvbjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHBhcnNlUmVhZGluZ0ludGVydmFsID0gJGV2ZW50ID0+IHRvSW50ZWdlcigkZXZlbnQudGFyZ2V0LnZhbHVlKTtcblxuICB1cGRhdGVNb2RlbCgpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHVuc2V0KHRoaXMuc3Vic2NyaXB0aW9uLCAnc3Vic2NyaXB0aW9uUGFyYW1ldGVycycpO1xuICAgICAgdW5zZXQodGhpcy5zdWJzY3JpcHRpb24sICdjeWNsaWNSZWFkUGFyYW1ldGVycycpO1xuICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uLnR5cGUgPT09ICdDeWNsaWNSZWFkJykge1xuICAgICAgICB0aGlzLnJlcXVpcmVDeWNsaWMgPSB0cnVlO1xuICAgICAgICB0aGlzLnJlcXVpcmVTdWJzY3JpcHRpb24gPSBmYWxzZTtcbiAgICAgICAgc2V0KHRoaXMuc3Vic2NyaXB0aW9uLCAnY3ljbGljUmVhZFBhcmFtZXRlcnMnLCB0aGlzLmN5Y2xpY1JlYWRQYXJhbWV0ZXJzKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5zdWJzY3JpcHRpb24udHlwZSA9PT0gJ1N1YnNjcmlwdGlvbicpIHtcbiAgICAgICAgdGhpcy5yZXF1aXJlQ3ljbGljID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVxdWlyZVN1YnNjcmlwdGlvbiA9IHRydWU7XG4gICAgICAgIHNldCh0aGlzLnN1YnNjcmlwdGlvbiwgJ3N1YnNjcmlwdGlvblBhcmFtZXRlcnMnLCB0aGlzLnN1YnNjcmlwdGlvblBhcmFtZXRlcnMpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnN1YnNjcmlwdGlvbi50eXBlID09PSAnTm9uZScpIHtcbiAgICAgICAgdGhpcy5yZXF1aXJlQ3ljbGljID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVxdWlyZVN1YnNjcmlwdGlvbiA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iXX0=